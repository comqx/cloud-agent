# Tiangong Deploy UI 菜单与功能详细设计

> 第一级菜单结构及详细功能清单

## 📋 第一级菜单结构

### 菜单设计原则
1. **功能聚合**：相关功能聚合在同一菜单下
2. **使用频率**：高频功能放在显眼位置
3. **工作流程**：按照部署工作流程组织菜单
4. **角色权限**：不同角色看到不同的菜单项

---

## 🎯 第一级菜单列表（共 11 个）

### 1. 📊 **概览仪表盘** (Dashboard)
**图标**：Dashboard / Home  
**优先级**：P0  
**访问权限**：所有用户

#### 详细功能
- **系统概览**
  - 环境总数统计（在线/离线）
- **部署统计**
  - 今日部署次数
  - 本周部署次数
  - 部署成功率（成功/失败/进行中）
  - 部署趋势图表（7天/30天）
- **任务统计**
  - 今日任务执行数
  - 任务成功率
  - 任务类型分布（Shell/SQL/K8s/API/File）
- **环境状态**
  - 环境健康度总览
  - 各环境在线状态
  - 环境告警数量
- **Agent 状态**
  - Agent 总数
  - 在线 Agent 数量
  - Agent 健康度
- **变更统计**
  - 待审批变更数量
  - 本周变更次数
  - 变更成功率
- **快速操作**
  - 快速创建部署任务
  - 快速创建变更请求
  - 快速查看告警
- **最近活动**
  - 最近部署记录
  - 最近变更记录
  - 最近任务执行记录

---

### 2. 🌍 **环境管理** (Environments)
**图标**：Environment / Cloud  
**优先级**：P0  
**访问权限**：环境管理员、运维人员

#### 详细功能
- **环境列表**
  - 环境列表展示（表格/卡片视图）
  - 环境搜索和过滤
  - 环境排序（按名称/状态/更新时间）
  - 环境标签筛选
- **环境详情**
  - 环境基本信息（名称、描述、类型）
  - 环境状态（在线/离线/断开连接）
  - 环境配置信息
  - 关联的 Agent 列表
  - 环境订阅的发布渠道
  - 环境约束配置
- **环境操作**
  - 创建环境
  - 编辑环境信息
  - 删除环境
  - 连接/断开环境
  - 环境健康检查
  - 环境配置同步
- **环境配置**
  - K8s 集群配置
  - 网络配置
  - 认证信息管理
  - 环境变量配置
  - 资源配置（CPU/内存配额）
- **环境分组**
  - 环境分组管理
  - 分组标签
  - 分组权限设置
- **维护窗口**
  - 维护窗口设置
  - 维护窗口日历视图
  - 维护窗口通知
- **环境监控**
  - 环境健康度监控
  - 环境资源使用情况
  - 环境告警历史

---

### 3. 🏢 **组织管理** (Organizations)
**图标**：Team / Apartment  
**优先级**：P0  
**访问权限**：系统管理员、组织管理员

#### 详细功能
- **组织部门列表**
  - 组织部门树形结构展示（支持层级结构）
  - 组织部门搜索和过滤
  - 组织部门状态筛选（活跃/停用）
  - 组织部门标签和分组
- **组织部门详情**
  - 基本信息（名称、描述、负责人、状态）
  - 组织层级关系（父部门、子部门）
  - 人员列表（按角色分组：管理员、测试、研发、运维）
  - 权限范围配置
  - 资源配额信息
  - 关联产品统计
  - 环境访问权限
  - 审批流程配置
  - 变更历史记录
- **组织部门操作**
  - 创建组织部门（支持选择父部门）
  - 编辑组织部门信息
  - 删除/停用组织部门
  - 移动组织部门（调整层级关系）
- **人员绑定**
  - 添加人员到组织部门
  - 设置人员在组织中的角色（管理员、测试、研发、运维）
  - 移除人员
  - 批量导入人员
- **权限配置**
  - 组织部门权限范围设置
  - 环境访问权限配置
  - 产品访问权限配置
  - 操作权限配置（读/写/执行/审批）
- **资源管理**
  - 资源配额设置（CPU、内存、存储等）
  - 资源使用统计
  - 资源使用趋势
- **统计报表**
  - 组织部门人员统计
  - 组织部门产品统计
  - 组织部门资源使用统计

---

### 4. 📦 **产品管理** (Products)
**图标**：Product / Package  
**优先级**：P0  
**访问权限**：产品管理员、开发者

#### 详细功能
- **产品列表**
  - 产品列表展示
  - 产品搜索和过滤（支持按组织部门筛选）
  - 产品分组和标签
  - 产品状态筛选（活跃/归档）
  - 显示产品绑定的组织部门
  - 点击产品进入产品详情页

- **产品详情页**（新的页签/页面）
  - **产品基本信息**
    - 产品名称、描述、类型
    - **组织部门绑定**（显示所有绑定的组织部门，支持多对多）
    - 产品状态（活跃/归档）
  - **产品操作**
    - 编辑产品信息
    - **组织部门绑定管理**（添加/移除组织部门，支持多对多）
    - **组织部门切换**（支持将产品切换到其他组织部门）
    - 归档/激活产品
    - 删除产品
  - **产品依赖关系**
    - 依赖关系可视化（依赖图）
    - 添加/删除依赖
    - 依赖版本要求
    - 依赖冲突检测
  - **产品约束**
    - 约束规则定义
    - 约束类型（版本要求、资源要求、环境要求）
    - 约束验证
    - 约束冲突检测
  - **版本列表**（可以选择版本，如 630、730、830 等大版本）
    - 版本列表展示
    - 版本创建和管理
    - 版本选择（点击版本进入版本详情页）
    - 版本对比
    - 版本回滚

- **版本详情页**（选中某个版本后进入）
  - **版本仪表盘**
    - 版本整体状态概览
    - 服务数量统计
    - 部署状态统计
    - 资源使用情况
    - 构建状态统计
    - 发布状态统计
  - **服务管理**（横向页签）
    - **服务列表**
      - 该版本下的所有服务列表
      - 服务基本信息（名称、状态、版本等）
      - 服务管理操作（启动、停止、重启等）
      - 服务配置管理
    - **SQL脚本**
      - SQL脚本列表
      - SQL脚本上传和管理
      - SQL脚本执行历史
      - SQL脚本版本管理
  - **部署方案管理**
    - 部署方案列表
    - **创建方案**：创建新的部署方案
    - 部署方案编辑和删除
    - 部署方案配置（蓝绿、金丝雀、滚动更新等策略）
    - 部署方案预览
  - **版本发布**
    - 发布列表和历史
    - **新建发布**：创建新的版本发布
      - 选择环境（开发、测试、预发布、生产等）
      - 选择版本（当前版本或其他版本）
      - 选择部署方案（从部署方案管理中选择）
      - 发布配置（发布渠道 RELEASE → CANARY → STABLE）
      - 发布审批流程配置
    - 发布状态监控
    - 发布审批流程
    - 发布历史记录
  - **构建管理**
    - 构建列表和历史
    - **新建构建**：创建新的构建任务
    - 构建配置管理
    - 构建日志查看
    - 构建状态监控
    - 构建触发规则配置

- **产品创建**
  - 创建产品（**必须选择至少一个组织部门**）
  - 产品基本信息填写
  - 组织部门绑定（创建时选择）

- **与部署计划的区别**
  - **产品版本发布**（在产品管理的版本详情页中）：
    - 单个产品单个版本的发布
    - 发布时需要选择环境、版本、部署方案
    - 发布渠道管理（RELEASE → CANARY → STABLE）
    - 版本发布审批
    - 版本发布历史
  - **部署计划**（独立菜单）：
    - 跨产品、跨版本的批量部署
    - 多环境批量部署
    - 部署计划模板和调度
    - 全局部署视图和统计

---

### 5. 🚀 **部署计划** (Deployment Plans)
**图标**：Rocket / Deploy  
**优先级**：P0  
**访问权限**：开发者、运维人员  
**功能定位**：跨产品、跨版本的批量部署管理（全局部署视图）

#### 详细功能
- **部署计划管理**
  - 部署计划列表（显示所有跨产品、跨版本的部署计划）
  - 创建部署计划（选择多个产品、多个版本、多个环境）
  - 部署计划详情（计划内容、执行状态、进度）
  - 部署计划编辑
  - 部署计划删除
- **批量部署执行**
  - 多产品指定版本发布到指定环境
  - 多产品指定版本发布到多个环境
  - 部署计划执行
  - 部署计划暂停/恢复
  - 部署计划取消
  - 部署计划重试
- **部署计划模板**
  - 模板列表（保存常用部署组合）
  - 创建模板（产品+版本+环境的组合）
  - 使用模板创建部署计划
  - 模板编辑和删除
- **部署策略配置**
  - 蓝绿部署配置
  - 金丝雀部署配置
  - 滚动更新配置
  - 部署策略应用到部署计划
- **全局部署视图**
  - 部署列表（跨产品、跨版本的部署视图）
  - 按环境/产品/版本筛选
  - 部署状态监控（进行中/成功/失败）
  - 批量部署进度监控
- **部署操作**
  - 批量部署执行
  - 批量部署暂停
  - 批量部署恢复
  - 批量部署回滚
  - 批量部署取消
  - 单个部署重试
- **部署监控**
  - 实时部署状态（批量部署进度）
  - 部署进度条（整体进度和单个部署进度）
  - 部署日志实时查看（支持查看单个部署日志）
  - 部署资源使用情况
- **部署历史**
  - 部署历史记录查询（支持多维度筛选）
  - 部署历史对比
  - 部署历史导出
  - 部署统计报表（全局视角）
- **部署审批**
  - 跨产品批量部署审批
  - 审批流程配置
  - 审批历史记录

#### 与产品版本发布的区别
- **产品版本发布**（在产品管理的版本详情页中）：
  - 单个产品版本的发布管理
  - 版本内的服务、SQL、配置管理
  - 版本级别的发布渠道和审批
  
- **部署计划**（本菜单）：
  - 跨产品、跨版本的批量部署
  - 全局部署视图和统计
  - 多环境批量部署管理

---

### 6. 📋 **任务管理** (Tasks)
**图标**：Task / List  
**优先级**：P0  
**访问权限**：所有用户

#### 详细功能
- **任务列表**
  - 任务列表展示（表格视图）
  - 任务搜索和过滤（按类型/状态/Agent/时间）
  - 任务排序
  - 任务标签筛选
- **任务详情**
  - 任务基本信息（类型、状态、创建时间）
  - 任务执行 Agent
  - 任务参数配置
  - 任务执行日志（实时/历史）
  - 任务执行结果
  - 任务执行时间统计
- **任务创建**
  - Shell 命令任务
  - SQL 执行任务（MySQL/PostgreSQL/Redis等）
  - K8s 操作任务
  - API 调用任务
  - 文件操作任务
- **任务操作**
  - 任务执行
  - 任务暂停
  - 任务取消
  - 任务重试
  - 任务克隆
  - 任务删除
- **任务模板**
  - 任务模板列表
  - 创建任务模板
  - 编辑任务模板
  - 使用模板创建任务
  - 模板共享
- **任务历史**
  - 任务历史记录查询
  - 任务历史对比
  - 任务历史导出
  - 任务统计分析

---

### 7. 🤖 **Agent 管理** (Agents)
**图标**：Agent / Server  
**优先级**：P0  
**访问权限**：运维人员、管理员

#### 详细功能
- **Agent 列表**
  - Agent 列表展示
  - Agent 搜索和过滤
  - Agent 状态筛选（在线/离线）
  - Agent 分组和标签
- **Agent 详情**
  - Agent 基本信息（ID、名称、版本）
  - Agent 状态（在线/离线/异常）
  - Agent 所在环境
  - Agent 健康检查结果
  - Agent 资源使用情况
  - Agent 执行任务统计
  - Agent 连接日志
- **Agent 操作**
  - Agent 注册信息查看
  - Agent 配置管理
  - Agent 重启指令
  - Agent 健康检查触发
  - Agent 日志查看
- **Agent 分组**
  - Agent 分组管理
  - 分组标签
  - 分组权限设置
- **Agent 监控**
  - Agent 健康度监控
  - Agent 性能指标
  - Agent 告警历史
  - Agent 任务执行统计

---

### 8. 🔄 **变更管理** (Changes)
**图标**：Change / Edit  
**优先级**：P0  
**访问权限**：所有用户（不同权限不同操作）

#### 详细功能
- **变更请求**
  - 变更请求列表
  - 创建变更请求
  - 变更请求详情
  - 变更请求编辑
  - 变更请求提交
  - 变更请求取消
- **变更审批**
  - 待审批变更列表
  - 审批流程查看
  - 审批操作（通过/拒绝/转交）
  - 审批意见填写
  - 审批历史记录
- **变更执行**
  - 变更执行计划
  - 变更执行状态
  - 变更执行日志
  - 变更执行结果
  - 变更回滚
- **变更计划**
  - 变更计划创建
  - 变更计划编辑
  - 变更计划执行
  - 变更计划暂停/恢复
  - 变更计划取消
- **维护窗口**
  - 维护窗口列表
  - 创建维护窗口
  - 维护窗口编辑
  - 维护窗口日历视图
  - 维护窗口通知
- **变更抑制**
  - 变更抑制规则配置
  - 变更冻结期设置
  - 变更抑制状态查看
- **变更历史**
  - 变更历史记录查询
  - 变更历史对比
  - 变更历史导出
  - 变更统计分析

---

### 9. 📝 **审计与合规** (Audit & Compliance)
**图标**：Audit / Shield  
**优先级**：P0  
**访问权限**：审计员、合规管理员、管理员

#### 详细功能
- **操作审计**
  - 操作日志列表
  - 操作日志搜索和过滤（按用户/操作类型/时间）
  - 操作详情查看
  - 操作日志导出
- **变更审计**
  - 变更审计记录
  - 变更审批审计
  - 变更执行审计
  - 变更影响分析
- **登录审计**
  - 登录日志列表
  - 登录成功/失败记录
  - 登录IP地址记录
  - 异常登录告警
- **权限审计**
  - 权限变更记录
  - 角色变更记录
  - 用户权限变更历史
- **审计报告**
  - 审计报告生成
  - 审计报告模板
  - 审计报告导出（PDF/Excel）
  - 审计报告定时生成
- **合规管理**
  - 合规策略配置
  - 合规检查规则
  - 合规检查执行
  - 合规检查结果
  - 合规违规告警
  - 合规报告生成
- **合规框架**
  - 等保合规支持
  - ISO 27001 合规支持
  - 自定义合规框架

---

### 10. ⚙️ **配置管理** (Configuration)
**图标**：Settings / Config  
**优先级**：P1  
**访问权限**：配置管理员、运维人员

#### 详细功能
- **环境配置**
  - 环境配置列表
  - 环境配置详情
  - 环境配置编辑
  - 环境配置版本管理
  - 环境配置同步
- **产品配置**
  - 产品配置列表
  - 产品配置详情
  - 产品配置编辑
  - 产品配置版本管理
  - 产品配置分发
- **配置模板**
  - 配置模板列表
  - 创建配置模板
  - 编辑配置模板
  - 使用模板创建配置
  - 模板版本管理
- **配置对比**
  - 配置差异对比
  - 配置版本对比
  - 配置环境对比
- **配置同步**
  - 配置同步任务
  - 配置同步历史
  - 配置同步状态
- **配置历史**
  - 配置变更历史
  - 配置回滚
  - 配置审计

---

### 11. 📊 **监控告警** (Monitoring & Alerting)
**图标**：Monitor / Bell  
**优先级**：P1  
**访问权限**：运维人员、SRE

#### 详细功能
- **系统监控**
  - 系统健康度监控
  - 系统性能指标（CPU/内存/磁盘/网络）
  - 系统资源使用趋势
  - 系统告警统计
- **环境监控**
  - 环境健康度监控
  - 环境资源使用情况
  - 环境告警列表
  - 环境监控图表
- **Agent 监控**
  - Agent 健康度监控
  - Agent 性能指标
  - Agent 告警列表
  - Agent 监控图表
- **部署监控**
  - 部署成功率统计
  - 部署耗时统计
  - 部署失败原因分析
  - 部署监控图表
- **告警管理**
  - 告警列表
  - 告警规则配置
  - 告警级别设置（严重/警告/信息）
  - 告警通知配置
  - 告警处理（确认/忽略/解决）
  - 告警历史记录
- **告警规则**
  - 告警规则列表
  - 创建告警规则
  - 编辑告警规则
  - 告警规则启用/禁用
  - 告警规则模板
- **通知配置**
  - 通知渠道配置（邮件/钉钉/企业微信/Slack）
  - 通知规则配置
  - 通知模板配置
  - 通知测试

---

### 12. 👥 **系统管理** (System Management)
**图标**：System / Users  
**优先级**：P0  
**访问权限**：系统管理员

#### 详细功能
- **人员管理**
  - 用户列表
  - 用户搜索和过滤
  - 用户详情查看
  - 创建用户
  - 编辑用户信息
  - 删除用户
  - 用户启用/禁用
  - 用户密码重置
- **用户组管理**
  - 用户组列表
  - 创建用户组
  - 编辑用户组
  - 删除用户组
  - 用户组成员管理
- **角色管理**
  - 角色列表
  - 创建角色
  - 编辑角色
  - 删除角色
  - 角色权限配置
- **权限管理**
  - 权限列表
  - 权限分配
  - 权限继承配置
  - 权限审计
- **系统设置**
  - 系统基本信息配置
  - 系统参数配置
  - 系统功能开关
  - 系统维护模式
- **集成管理**
  - SSO 配置（SAML/OAuth）
  - 外部系统集成配置
  - Webhook 配置
  - API 密钥管理
- **通知设置**
  - 全局通知配置
  - 通知渠道管理
  - 通知模板管理
- **插件管理**
  - 执行器插件列表
  - 插件启用/禁用
  - 插件配置管理
  - 自定义插件上传

---

## 📐 菜单布局建议

### 顶部导航栏
- Logo + 项目名称
- 用户头像/下拉菜单（个人设置、退出登录）
- 通知中心图标
- 帮助文档链接

### 左侧菜单栏（第一级菜单）
```
📊 概览仪表盘
🌍 环境管理
📦 产品管理
🏢 组织管理
📋 部署计划
📋 任务管理
🤖 Agent 管理
🔄 变更管理
📝 审计与合规
⚙️ 配置管理
📊 监控告警
👥 系统管理
```

### 菜单展开方式
- 默认展开：概览仪表盘、部署计划、任务管理
- 点击展开：其他菜单项
- 支持菜单折叠/展开

---

## 🔐 权限控制

### 角色与菜单访问权限

| 角色 | 可访问菜单 |
|------|-----------|
| **超级管理员** | 所有菜单 |
| **系统管理员** | 除"审计与合规"外的所有菜单 |
| **组织管理员** | 概览、组织管理、产品管理（本组织）、部署计划、任务管理、变更管理 |
| **环境管理员** | 概览、环境管理、部署计划、任务管理、Agent 管理、变更管理、监控告警 |
| **产品管理员** | 概览、产品管理（本组织）、部署计划、任务管理、变更管理 |
| **开发者** | 概览、产品管理（本组织）、部署计划、任务管理、变更管理 |
| **运维人员** | 概览、环境管理、部署计划、任务管理、Agent 管理、变更管理、监控告警、配置管理 |
| **审计员** | 概览、审计与合规 |
| **只读用户** | 概览、环境管理（只读）、产品管理（只读）、部署计划（只读）、任务管理（只读）、Agent 管理（只读） |

---

## 📱 响应式设计

### 桌面端（≥1200px）
- 左侧固定菜单栏（宽度 240px）
- 主内容区域自适应

### 平板端（768px - 1199px）
- 左侧可折叠菜单栏
- 主内容区域自适应

### 移动端（<768px）
- 底部导航栏（主要功能）
- 侧边抽屉菜单（全部功能）
- 主内容区域全屏

---

## 🎨 UI/UX 设计建议

1. **统一设计语言**：使用 Ant Design 或类似组件库
2. **颜色方案**：
   - 主色：蓝色系（科技感）
   - 成功：绿色
   - 警告：橙色
   - 错误：红色
   - 信息：灰色
3. **图标系统**：使用统一的图标库（Ant Design Icons）
4. **交互反馈**：所有操作提供明确的成功/失败反馈
5. **加载状态**：所有异步操作显示加载状态
6. **错误处理**：友好的错误提示和错误恢复建议

---

## 📝 备注

- 所有菜单项支持国际化（i18n）
- 菜单项支持自定义排序（管理员）
- 菜单项支持显示/隐藏（基于权限）
- 菜单项支持快捷键导航

