# Tiangong Deploy UI 模块设计

> 对标 Palantir Apollo 的控制台设计

## 📋 核心模块列表

### 一、基础管理模块（已有/规划中）

#### 1. **环境管理** (Environment Management) ✅
- **功能**：
  - 环境列表（开发、测试、预发布、生产等）
  - 环境连接状态监控（在线/离线/断开连接）
  - 环境配置管理（K8s 集群、网络、认证信息）
  - 环境标签和分组
  - 环境维护窗口设置
  - Air-gapped 环境支持
- **对标 Apollo**：Environments

#### 2. **产品管理** (Product Management) ✅
- **功能**：
  - 产品/应用定义
  - 产品组织部门绑定（创建时必须选择，支持多对多关系）
  - 产品组织部门切换（支持切换绑定到其他组织部门）
  - **产品详情页**（新的页签/页面）
    - 产品基本信息（名称、描述、类型、组织部门等）
    - 产品依赖关系（依赖图）
    - 产品约束定义（版本要求、资源要求等）
    - **版本列表**（可以选择版本，如 630、730、830 等大版本）
      - 版本创建和管理
      - 版本选择（点击版本进入版本详情页）
  - **版本详情页**（选中某个版本后进入）
    - **版本仪表盘**：版本整体状态、服务数量、部署状态、资源使用等
    - **服务管理**（横向页签）
      - 服务列表：该版本下的所有服务列表和管理
      - SQL脚本：版本相关的SQL脚本管理
    - **部署方案管理**：该版本的部署策略和方案
      - 创建方案：创建新的部署方案
      - 方案列表和管理
    - **版本发布**：该版本的发布管理
      - 新建发布：创建新的版本发布（包含：选择环境、选择版本、选择部署方案）
      - 发布列表和历史
      - 发布渠道管理（RELEASE → CANARY → STABLE）
      - 发布审批流程
    - **构建管理**：该版本的CI/CD构建管理
      - 新建构建：创建新的构建任务
      - 构建列表和历史
      - 构建配置
  - 产品组织部门权限隔离
- **与部署计划的区别**：
  - 产品版本发布：单个产品单个版本的发布（在产品管理的版本详情页中）
  - 部署计划：跨产品、跨版本的批量部署（独立模块）
- **对标 Apollo**：Applications/Products

#### 3. **组织管理** (Organization Management) 🎯
- **功能**：
  - 组织部门创建和管理（支持层级结构）
  - 组织部门基本信息（名称、描述、负责人、状态）
  - 组织部门人员绑定（管理员、测试、研发、运维等角色）
  - 组织部门权限范围配置
  - 组织部门资源配额管理
  - 组织部门产品关联统计
  - 组织部门环境访问权限
  - 组织部门审批流程配置
  - 组织部门标签和分组
  - 组织部门变更历史
- **重要性**：⭐⭐⭐⭐⭐

#### 4. **人员管理** (User Management) ✅
- **功能**：
  - 用户账号管理
  - 用户组管理
  - 用户角色分配
  - 用户活动日志
  - 用户组织部门归属
- **对标 Apollo**：Users & Groups

#### 5. **权限管理** (Permission Management) ✅
- **功能**：
  - 基于角色的访问控制（RBAC）
  - 环境级别权限隔离
  - 产品级别权限控制
  - 操作权限（读/写/执行/审批）
  - 权限继承和委托
- **对标 Apollo**：Access Control

---

### 二、部署与发布模块（核心功能）

#### 6. **部署计划** (Deployment Plan) 🎯
- **功能定位**：跨产品、跨版本的批量部署管理（全局部署视图）
- **功能**：
  - 部署计划创建（选择多个产品、多个版本、多个环境）
  - 批量部署执行（多产品指定版本发布到指定环境或多个环境）
  - 部署计划管理（创建、编辑、暂停、取消、执行）
  - 部署计划模板（保存常用部署组合）
  - 全局部署列表（跨产品、跨版本的部署视图）
  - 部署状态实时监控（批量部署进度）
  - 部署历史查询（按时间、环境、产品、版本筛选）
  - 部署统计报表（全局视角的部署成功率、耗时等）
  - 部署审批流程（跨产品批量部署审批）
  - 部署失败自动重试
  - 部署回滚操作（支持批量回滚）
- **与产品版本发布的区别**：
  - 产品版本发布：单个产品版本的发布管理（在产品管理的版本详情页中）
  - 部署计划：跨产品、跨版本的批量部署管理（全局视图）
- **对标 Apollo**：Deployment Plans
- **重要性**：⭐⭐⭐⭐⭐

#### 8. **任务管理** (Task Management) ✅
- **功能**：
  - 任务列表（Shell、SQL、K8s、API、File）
  - 任务执行历史
  - 任务状态跟踪
  - 任务日志实时查看
  - 任务重试和取消
- **当前状态**：已有基础功能
- **重要性**：⭐⭐⭐⭐

#### 9. **Agent 管理** (Agent Management) ✅
- **功能**：
  - Agent 列表和状态监控
  - Agent 健康检查
  - Agent 分组和标签
  - Agent 配置管理
  - Agent 连接日志
- **当前状态**：已有基础功能
- **重要性**：⭐⭐⭐⭐

---

### 三、变更与合规模块

#### 10. **变更管理** (Change Management) 🎯
- **功能**：
  - 变更请求创建
  - 变更审批流程（多级审批）
  - 变更计划（维护窗口）
  - 变更抑制规则（变更冻结期）
  - 变更影响分析
  - 变更执行跟踪
- **对标 Apollo**：Change Management
- **重要性**：⭐⭐⭐⭐⭐

#### 11. **审计日志** (Audit Logs) 🎯
- **功能**：
  - 操作审计日志（谁、何时、做了什么）
  - 变更审计追踪
  - 登录审计
  - 权限变更审计
  - 审计报告生成
  - 审计日志导出
- **对标 Apollo**：Audit & Compliance
- **重要性**：⭐⭐⭐⭐⭐

#### 12. **合规管理** (Compliance Management) 🎯
- **功能**：
  - 合规策略定义（等保、ISO 27001等）
  - 合规检查规则
  - 合规报告生成
  - 合规状态监控
  - 合规违规告警
- **对标 Apollo**：Compliance Framework
- **重要性**：⭐⭐⭐⭐

---

### 四、配置与资源模块

#### 13. **配置管理** (Configuration Management) 🎯
- **功能**：
  - 环境配置管理
  - 产品配置管理
  - 配置版本控制
  - 配置模板管理
  - 配置差异对比
  - 配置同步和分发
- **对标 Apollo**：Configuration Management
- **重要性**：⭐⭐⭐⭐

#### 14. **约束引擎** (Constraint Engine) 🎯
- **功能**：
  - 产品约束定义（依赖关系、版本要求）
  - 环境约束定义（维护窗口、变更限制）
  - 约束验证和协调
  - 约束冲突检测
  - 约束规则管理
- **对标 Apollo**：Constraints
- **重要性**：⭐⭐⭐⭐⭐

#### 15. **资源管理** (Resource Management) 🎯
- **功能**：
  - 计算资源监控（CPU、内存）
  - 存储资源管理
  - 网络资源管理
  - 资源配额管理
  - 资源使用统计
- **重要性**：⭐⭐⭐

---

### 五、监控与可观测性模块

#### 16. **监控告警** (Monitoring & Alerting) 🎯
- **功能**：
  - 系统健康监控
  - Agent 状态监控
  - 部署成功率统计
  - 告警规则配置
  - 告警通知（邮件、钉钉、企业微信）
  - 告警历史记录
- **重要性**：⭐⭐⭐⭐

#### 17. **日志管理** (Log Management) ✅
- **功能**：
  - 集中日志查看
  - 日志搜索和过滤
  - 日志实时流式查看
  - 日志导出
  - 日志归档
- **当前状态**：已有基础功能（WebSocket 实时日志）
- **重要性**：⭐⭐⭐⭐

#### 18. **仪表盘** (Dashboard) 🎯
- **功能**：
  - 系统概览仪表盘
  - 部署统计图表
  - 环境状态总览
  - 任务执行统计
  - 自定义仪表盘
- **重要性**：⭐⭐⭐⭐

---

### 六、工作流与自动化模块

#### 19. **工作流管理** (Workflow Management) 🎯
- **功能**：
  - 工作流定义（部署流程、审批流程）
  - 工作流执行引擎
  - 工作流模板
  - 工作流版本管理
  - 工作流执行历史
- **对标 Apollo**：Orchestration
- **重要性**：⭐⭐⭐⭐

#### 20. **模板管理** (Template Management) 🎯
- **功能**：
  - 部署模板（K8s YAML、SQL 脚本）
  - 配置模板
  - 任务模板
  - 模板版本管理
  - 模板共享和复用
- **重要性**：⭐⭐⭐

#### 21. **自动化规则** (Automation Rules) 🎯
- **功能**：
  - 自动部署规则（基于条件触发）
  - 自动审批规则
  - 自动回滚规则
  - 规则引擎配置
- **对标 Apollo**：Autonomous Deployment
- **重要性**：⭐⭐⭐⭐

---

### 七、文件与存储模块

#### 22. **文件管理** (File Management) ✅
- **功能**：
  - 文件上传和存储
  - 文件分发到 Agent
  - 文件版本管理
  - 文件权限控制
  - 文件使用统计
- **当前状态**：已有基础功能
- **重要性**：⭐⭐⭐

---

### 八、集成与扩展模块

#### 23. **API 管理** (API Management) 🎯
- **功能**：
  - API 密钥管理
  - API 调用统计
  - API 文档
  - API 限流配置
- **重要性**：⭐⭐⭐

#### 24. **集成管理** (Integration Management) 🎯
- **功能**：
  - 外部系统集成（Jenkins、GitLab CI/CD）
  - Webhook 配置
  - 通知集成（邮件、钉钉、企业微信、Slack）
  - SSO 集成（SAML、OAuth）
- **重要性**：⭐⭐⭐⭐

#### 25. **插件管理** (Plugin Management) 🎯
- **功能**：
  - 执行器插件列表
  - 插件配置管理
  - 插件启用/禁用
  - 自定义插件上传
- **重要性**：⭐⭐⭐

---

### 九、通知与协作模块

#### 26. **通知管理** (Notification Management) 🎯
- **功能**：
  - 通知规则配置
  - 通知渠道管理（邮件、钉钉、企业微信、Slack）
  - 通知模板
  - 通知历史记录
- **重要性**：⭐⭐⭐

---

## 📊 模块优先级建议

### P0 - 核心必需（MVP）
1. ✅ 环境管理
2. ✅ 产品管理
3. 🎯 组织管理
4. ✅ 人员管理
5. ✅ 权限管理
6. 🎯 发布管理
7. 🎯 部署管理
8. ✅ 任务管理
9. ✅ Agent 管理
10. 🎯 变更管理
11. 🎯 审计日志

### P1 - 重要功能（第一阶段）
12. 🎯 约束引擎
13. 🎯 配置管理
14. 🎯 监控告警
15. ✅ 日志管理
16. 🎯 仪表盘
17. 🎯 合规管理

### P2 - 增强功能（第二阶段）
18. 🎯 工作流管理
19. 🎯 自动化规则
20. 🎯 模板管理
21. 🎯 集成管理
22. 🎯 通知管理
23. 🎯 资源管理

### P3 - 扩展功能（第三阶段）
24. 🎯 API 管理
25. 🎯 插件管理

---

## 🎯 模块设计原则

1. **对标 Apollo**：核心功能对齐 Palantir Apollo
2. **渐进式开发**：先实现 MVP，再逐步增强
3. **模块化设计**：每个模块独立，便于开发和维护
4. **统一体验**：所有模块使用统一的设计语言和交互模式
5. **可扩展性**：支持插件和自定义扩展

---

## 📝 备注

- ✅ 表示已有基础功能或已规划
- 🎯 表示需要新开发
- 重要性用 ⭐ 数量表示（1-5 星）

