# Tiangong Deploy 核心目标与角色痛点分析

> 对标 Palantir Apollo：一个面向混合云环境的软件部署与远程管控平台

参考：[Palantir Apollo 官方文档](https://www.palantir.com/docs/apollo/core/introduction/)

---

## 🎯 核心目标

### 一句话定位

**Tiangong Deploy 是一个开源的混合云软件部署与远程管控平台，让开发者一次编写代码，即可安全、合规地部署到任何环境（公有云、私有云、混合云、边缘节点），无需关心基础设施的复杂性和环境差异。**

### 核心价值主张

#### 1. **Write Once, Deploy Anywhere（一次编写，随处部署）**
- 开发者只需编写一次代码，无需关心如何到达所有环境
- 支持所有主流云平台、本地数据中心、边缘节点
- 自动处理不同环境的配置差异和约束条件

#### 2. **统一的多环境管理**
- 无论环境位置或连接状态如何，都能统一管理
- 支持连接环境、断开连接环境（air-gapped）、混合环境
- 单一控制面板配置、跟踪和监控所有安装

#### 3. **合规感知的变更管理**
- 内置变更审批流程，防止未授权变更
- 完整的审计跟踪，满足合规要求（如等保、ISO 27001等）
- 支持维护窗口、变更抑制等合规控制

#### 4. **自主部署（Autonomous Deployment）**
- 自动编排软件升级和变更
- 基于约束条件自动决策部署时机
- 减少人工干预，提高部署效率

#### 5. **灵活的环境订阅模型**
- 环境操作者订阅适合的发布渠道（如 RELEASE、CANARY、STABLE）
- 开发者定义发布渠道的升级条件
- 自动推广和部署，无需手动干预

---

## 👥 不同角色的痛点与解决方案

### 阶段一：开发者（Developers）

#### 🔴 核心痛点

1. **环境碎片化问题**
   - 需要为不同环境（开发、测试、生产、边缘）编写不同的部署脚本
   - 每个环境可能有不同的配置要求、网络限制、安全策略
   - 维护多套部署流程，成本高且易出错

2. **部署复杂性**
   - 需要了解每个环境的特殊要求（K8s版本、网络策略、存储类型等）
   - 跨云、跨地域部署需要处理网络、认证、权限等差异
   - 无法专注于业务逻辑开发

3. **发布流程繁琐**
   - 需要手动选择目标环境并执行部署
   - 缺乏统一的发布渠道和自动化推广机制
   - 无法实现"一次发布，自动推广到所有环境"

4. **缺乏部署约束管理**
   - 无法定义跨服务依赖、数据库版本要求等约束
   - 环境特定的约束（如维护窗口）需要手动协调
   - 容易在错误的时间部署到错误的环境

#### ✅ Tiangong Deploy 解决方案

- **统一部署模型**：所有环境使用相同的部署接口，自动适配环境差异
- **发布渠道机制**：定义 RELEASE → CANARY → STABLE 等渠道，环境自动订阅
- **约束引擎**：开发者定义产品约束，环境定义环境约束，系统自动协调
- **一次编写**：开发者只需关注代码，部署由平台自动处理

---

### 阶段二：环境操作者（Environment Operators / 运维人员）

#### 🔴 核心痛点

1. **多环境管理困难**
   - 需要管理多个环境（生产、预发布、测试等），每个环境可能有不同的工具和流程
   - 跨地域、跨云的环境管理缺乏统一入口
   - 无法实时了解所有环境的部署状态

2. **变更风险控制**
   - 缺乏统一的变更审批流程
   - 无法定义环境特定的维护窗口和变更限制
   - 变更历史难以追溯，审计困难

3. **部署操作复杂**
   - 需要手动执行 SQL、K8s 部署、文件分发等操作
   - 跨环境操作需要登录多个系统，使用多套工具
   - 缺乏统一的执行日志和回滚机制

4. **合规要求**
   - 需要满足等保、ISO 27001 等合规要求
   - 变更需要审批、记录、审计
   - 缺乏自动化的合规控制机制

#### ✅ Tiangong Deploy 解决方案

- **统一控制面板**：一个界面管理所有环境，实时查看部署状态
- **变更管理**：定义审批流程、维护窗口、变更抑制规则
- **零代码操作**：通过 Web UI 或 CLI 完成所有操作，无需编写脚本
- **完整审计**：所有变更自动记录，支持审计和追溯
- **环境订阅**：环境订阅合适的发布渠道，自动接收符合条件的发布

---

### 阶段三：SRE/DevOps 工程师

#### 🔴 核心痛点

1. **工具集成复杂**
   - 需要集成 Ansible、Kubectl、数据库客户端、监控工具等多种工具
   - 工具之间缺乏统一的数据模型和接口
   - 维护多套自动化脚本，成本高

2. **跨环境自动化困难**
   - 不同环境的网络、认证、权限差异导致自动化脚本复杂
   - 断开连接环境（air-gapped）无法使用传统的 CI/CD 流程
   - 缺乏统一的自动化框架

3. **可观测性不足**
   - 部署过程缺乏实时可见性
   - 无法统一收集和分析跨环境的部署指标
   - 问题定位困难，缺乏统一的日志和监控

4. **扩展性限制**
   - 现有工具难以扩展新的执行器类型
   - 无法灵活定义自定义工作流
   - 插件化能力不足

#### ✅ Tiangong Deploy 解决方案

- **插件化架构**：统一的 Executor 接口，易于扩展新的执行器类型
- **统一执行模型**：所有操作都通过任务系统，支持 API 调用和自动化集成
- **实时可观测性**：WebSocket 实时日志流，支持与 Prometheus、DataDog 等监控工具集成
- **灵活扩展**：支持自定义执行器、工作流、约束条件

---

### 阶段四：安全与合规团队（Security & Compliance）

#### 🔴 核心痛点

1. **变更控制不足**
   - 无法防止未授权的变更
   - 缺乏变更审批流程和权限控制
   - 变更历史难以追溯

2. **审计困难**
   - 变更记录分散在各个工具中
   - 缺乏统一的审计日志
   - 无法满足合规审计要求

3. **安全策略执行**
   - 无法统一执行安全策略（如不允许在生产环境直接部署）
   - 缺乏环境隔离和权限控制
   - 敏感操作无法追溯

#### ✅ Tiangong Deploy 解决方案

- **变更审批**：集成身份提供商（SAML），定义审批流程和授权审批人
- **完整审计**：所有变更自动记录，支持审计查询和报告
- **权限控制**：基于角色的访问控制（RBAC），支持环境级别的权限隔离
- **合规框架**：内置合规控制机制，支持等保、ISO 27001 等要求

---

### 阶段五：平台/基础设施团队（Platform Team）

#### 🔴 核心痛点

1. **平台能力抽象不足**
   - 开发者需要直接操作底层基础设施（K8s、数据库等）
   - 缺乏统一的能力抽象层
   - 平台能力难以复用和标准化

2. **多环境一致性**
   - 不同环境的配置、版本、能力可能不一致
   - 难以保证跨环境的一致性
   - 环境差异导致的问题难以定位

3. **资源管理**
   - 无法统一管理跨环境的资源（文件、配置、密钥等）
   - 资源分发和同步困难
   - 缺乏统一的资源生命周期管理

#### ✅ Tiangong Deploy 解决方案

- **能力抽象**：统一的执行器接口，抽象底层基础设施差异
- **配置管理**：统一的环境配置管理，支持配置覆盖和版本控制
- **资源管理**：统一的文件存储和分发机制，支持跨环境资源同步
- **一致性保证**：通过约束引擎保证跨环境的一致性

---

## 🚀 核心能力对比

| 能力 | Palantir Apollo | Tiangong Deploy（当前） | Tiangong Deploy（目标） |
|------|----------------|-------------------|-------------------|
| **多环境管理** | ✅ 支持连接/断开连接环境 | ✅ 支持混合云环境 | ✅ 增强 air-gapped 支持 |
| **发布渠道** | ✅ Release Channels | ❌ 未实现 | 🎯 计划实现 |
| **约束引擎** | ✅ 产品和环境约束 | ❌ 未实现 | 🎯 计划实现 |
| **变更管理** | ✅ 审批流程 | ⚠️ 基础支持 | 🎯 增强审批流程 |
| **审计跟踪** | ✅ 完整审计 | ✅ 基础审计 | 🎯 增强审计能力 |
| **自主部署** | ✅ 自动编排 | ⚠️ 手动触发 | 🎯 计划实现自动编排 |
| **插件化** | ✅ 模块化 | ✅ 执行器插件 | ✅ 保持优势 |
| **实时可观测** | ✅ 监控集成 | ✅ WebSocket 日志 | ✅ 保持优势 |
| **合规支持** | ✅ FedRAMP/IL5/IL6 | ⚠️ 基础支持 | 🎯 增强合规能力 |

---

## 📋 下一步发展方向

### 短期目标（1-3个月）

1. **发布渠道机制**
   - 实现 Release Channels（RELEASE、CANARY、STABLE）
   - 环境订阅发布渠道
   - 自动推广机制

2. **约束引擎**
   - 产品约束定义（依赖、版本要求等）
   - 环境约束定义（维护窗口、变更限制等）
   - 约束验证和协调

3. **变更管理增强**
   - 审批流程定义
   - 审批人管理
   - 变更请求跟踪

### 中期目标（3-6个月）

1. **自主部署**
   - 自动决策部署时机
   - 基于约束的自动编排
   - 回滚策略

2. **合规增强**
   - 等保合规支持
   - 审计报告生成
   - 权限管理增强

3. **Air-gapped 支持**
   - 断开连接环境支持
   - 离线部署包
   - 同步机制

### 长期目标（6-12个月）

1. **模块化部署**
   - 模块定义和管理
   - 组合模块支持
   - Git 仓库集成

2. **可观测性集成**
   - Prometheus 集成
   - DataDog 集成
   - 自定义监控指标

3. **企业级特性**
   - 多租户支持
   - 高可用部署
   - 性能优化

---

## 🎯 总结

Tiangong Deploy 的核心目标是成为**开源的 Palantir Apollo**，为组织提供：

1. **统一的多环境软件部署能力**：无论环境在哪里，都能统一管理
2. **合规感知的变更管理**：满足合规要求，同时提高部署效率
3. **自主部署能力**：减少人工干预，自动化软件升级和变更
4. **灵活的环境订阅模型**：环境操作者和开发者协作，自动推广发布

通过解决不同角色在不同阶段的痛点，Tiangong Deploy 帮助组织将宝贵的工程资源重新聚焦到创新上，而不是基础设施的复杂性上。

