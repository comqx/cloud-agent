# Cloud UI - 项目概述

## 🎯 项目定位

**Cloud UI** 是一个开源的混合云远程执行与部署系统，支持文件分发、SQL执行、命令执行、Kubernetes部署和实时日志回传，零开发成本，面向运维人员。

### 核心特征

🚀 **无需开发能力**：只需部署 Cloud + Agent，即可在网页/CLI 上完成：
- 文件上传
- SQL 执行
- 远程命令
- API 调用
- Kubernetes 发布
- 实时日志返回

### 对标产品

参考 **Palantir Apollo**：一个面向混合云环境的软件部署与远程管控平台

---

## 🏗 系统架构

```
┌────────────── Cloud Server ──────────────┐
│ UI界面 / API / Auth / Task中心 / 文件服务 │
└──────────────────────────────────────────┘
              ▲           ▲
      WebSocket          HTTP
              ▼           ▼
┌──────────────────────────────────────────┐
│               Agent节点1                 │
│ 注册自身 → 接收任务 → 执行 → 回传日志     │
│ 通用执行器：SQL、Shell、K8s、API         │
└──────────────────────────────────────────┘
┌──────────────────────────────────────────┐
│               Agent节点2                 │
└──────────────────────────────────────────┘
```

---

## ✨ 核心功能

| 模块 | 功能 | 交互方式 |
|------|------|---------|
| **Agent注册** | 自动注册到Cloud端，并维持连接 | 免配置 / 最少配置 |
| **任务派发** | Cloud 指定 Agent 下发执行任务 | UI / API / CLI |
| **文件分发** | ZIP/YAML/SQL 上传，一键分发到多个Agent | Web界面 / REST接口 |
| **实时日志** | 执行中实时返回日志（WebSocket流式） | UI可滚动显示 |
| **SQL执行** | 云上上传SQL → 云下执行 → 实时结果返回 | 插件式执行器 |
| **K8s发布** | 上传 YAML → apply → 返回部署状态和Pod日志 | 插件式执行器 |
| **Shell命令** | 在远端执行命令，返回日志/结果 | 支持Dashboard终端 |
| **API调用** | 执行curl/http请求到云下资源 | 适用于各种API测试 |
| **统一回放** | 所有历史执行记录可回放、下载、审计 | UI/API |

---

## 🔒 安全特性

### 命令白名单（Command Whitelist）
- ✅ 基于正则表达式的命令验证
- ✅ 允许安全操作（kubectl get, docker ps, ls, cat）
- ✅ 阻止危险命令（rm -rf /, shutdown, mkfs）
- ✅ 防止命令注入（;, &&, ||）
- ✅ 完整审计日志

### RBAC 权限控制
- Kubernetes ClusterRole/ClusterRoleBinding
- 细粒度的资源访问控制
- Agent 级别的权限隔离

### TLS/WSS 加密
- 支持自签名证书
- WSS (WebSocket Secure) 通信
- mTLS 双向认证（可选）

---

## 🚀 快速开始

### 使用 Docker Compose

```bash
# 1. 克隆仓库
git clone https://github.com/your-org/tiangong-deploy.git
cd tiangong-deploy

# 2. 生成证书（可选，用于 HTTPS/WSS）
./scripts/generate-cert.sh

# 3. 启动服务
cd deployments
docker-compose up -d

# 4. 访问 UI
open http://localhost:80
```

### 使用 Kubernetes/Helm

```bash
# 1. 添加 Helm 仓库（如果已发布）
helm repo add tiangong https://your-helm-repo.com
helm repo update

# 2. 安装
helm install tiangong-deploy tiangong/tiangong-deploy \
  --set cloud.service.type=LoadBalancer \
  --set ui.enabled=true

# 3. 获取访问地址
kubectl get svc tiangong-deploy-ui
```

---

## 🎯 使用场景

### 场景 1：远程执行 SQL

```
1. 上传 SQL 文件
2. 选择目标 Agent（如 prod-db-agent）
3. 点击执行
4. 实时查看执行日志
5. 查看结果（成功/失败）
```

### 场景 2：Kubernetes 部署

```
1. 上传 deployment.yaml
2. 选择区域 Agent
3. 执行 kubectl apply
4. 查看 Pod 实时日志
```

### 场景 3：批量文件分发

```
1. 上传 release.zip
2. 选择多个 Agent
3. 一键分发
4. 查看分发进度和结果
```

---

## 📊 核心价值

### 对开发者
- ✅ **一次编写，随处部署**：无需关心环境差异
- ✅ **统一部署模型**：所有环境使用相同接口
- ✅ **插件化扩展**：易于添加新的执行器类型

### 对运维人员
- ✅ **零代码操作**：Web UI 完成所有操作
- ✅ **统一控制面板**：一个界面管理所有环境
- ✅ **完整审计**：所有变更自动记录

### 对 SRE/DevOps
- ✅ **API 驱动**：支持自动化集成
- ✅ **实时可观测**：WebSocket 实时日志流
- ✅ **灵活扩展**：自定义执行器和工作流

### 对安全团队
- ✅ **命令白名单**：防止危险操作
- ✅ **审计日志**：完整的操作记录
- ✅ **权限控制**：RBAC 和环境隔离

---

## 🛠 技术栈

| 组件 | 技术选型 |
|------|---------|
| **后端** | Golang (Cloud + Agent) |
| **前端** | React + TypeScript + Vite |
| **通信** | WebSocket (WSS) + HTTP/HTTPS |
| **数据库** | SQLite (可选 PostgreSQL) |
| **部署** | Docker / Kubernetes / Helm |
| **认证** | Token / mTLS |

---

## 📚 文档导航

- [1-架构设计.md](./1-架构设计.md) - 详细的架构和技术设计
- [2-部署指南.md](./2-部署指南.md) - 部署说明和配置
- [3-API文档.md](./3-API文档.md) - API 接口参考
- [4-安全配置.md](./4-安全配置.md) - 安全加固和配置
- [5-开发指南.md](./5-开发指南.md) - 开发和贡献指南

---

## 🤝 贡献

欢迎贡献代码、文档或提出问题！

---

## 📄 许可证

[MIT License](../LICENSE)
