# Tiangong Deploy

> ä¸€ä¸ªå¼€æºçš„æ··åˆäº‘è½¯ä»¶éƒ¨ç½²ä¸è¿œç¨‹ç®¡æ§å¹³å°ï¼Œå¯¹æ ‡ Palantir Apollo

**Tiangong Deploy** æ˜¯ä¸€ä¸ªå¼€æºçš„æ··åˆäº‘è½¯ä»¶éƒ¨ç½²ä¸è¿œç¨‹ç®¡æ§å¹³å°ï¼Œè®©å¼€å‘è€…ä¸€æ¬¡ç¼–å†™ä»£ç ï¼Œå³å¯å®‰å…¨ã€åˆè§„åœ°éƒ¨ç½²åˆ°ä»»ä½•ç¯å¢ƒï¼ˆå…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€æ··åˆäº‘ã€è¾¹ç¼˜èŠ‚ç‚¹ï¼‰ï¼Œæ— éœ€å…³å¿ƒåŸºç¡€è®¾æ–½çš„å¤æ‚æ€§å’Œç¯å¢ƒå·®å¼‚ã€‚

> å‚è€ƒï¼š[Palantir Apollo](https://www.palantir.com/docs/apollo/core/introduction/) - ä¸€ä¸ªå¯æ‰©å±•ã€å¯æ‰©å±•çš„å¹³å°ï¼Œç”¨äºç®¡ç†å’Œéƒ¨ç½²è½¯ä»¶ï¼Œç¼–ç äº†æ“ä½œæœ€ä½³å®è·µ

---

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

### Write Once, Deploy Anywhereï¼ˆä¸€æ¬¡ç¼–å†™ï¼Œéšå¤„éƒ¨ç½²ï¼‰

å¼€å‘è€…åªéœ€ç¼–å†™ä¸€æ¬¡ä»£ç ï¼Œæ— éœ€å…³å¿ƒå¦‚ä½•åˆ°è¾¾æ‰€æœ‰ç¯å¢ƒã€‚Tiangong Deploy è‡ªåŠ¨å¤„ç†ä¸åŒç¯å¢ƒçš„é…ç½®å·®å¼‚ã€ç½‘ç»œé™åˆ¶ã€å®‰å…¨ç­–ç•¥ç­‰å¤æ‚æ€§ï¼Œè®©å¼€å‘è€…ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘åˆ›æ–°ã€‚

### ç»Ÿä¸€çš„å¤šç¯å¢ƒç®¡ç†

æ— è®ºç¯å¢ƒä½ç½®æˆ–è¿æ¥çŠ¶æ€å¦‚ä½•ï¼Œéƒ½èƒ½ç»Ÿä¸€ç®¡ç†ã€‚æ”¯æŒï¼š
- **è¿æ¥ç¯å¢ƒ**ï¼šå…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€æ··åˆäº‘
- **æ–­å¼€è¿æ¥ç¯å¢ƒ**ï¼šAir-gappedã€è¾¹ç¼˜èŠ‚ç‚¹
- **æ··åˆç¯å¢ƒ**ï¼šè·¨åœ°åŸŸã€è·¨äº‘çš„å¤šç¯å¢ƒç»„åˆ

### åˆè§„æ„ŸçŸ¥çš„å˜æ›´ç®¡ç†

å†…ç½®å˜æ›´å®¡æ‰¹æµç¨‹ï¼Œé˜²æ­¢æœªæˆæƒå˜æ›´ã€‚å®Œæ•´çš„å®¡è®¡è·Ÿè¸ªï¼Œæ»¡è¶³åˆè§„è¦æ±‚ï¼ˆå¦‚ç­‰ä¿ã€ISO 27001ç­‰ï¼‰ã€‚æ”¯æŒç»´æŠ¤çª—å£ã€å˜æ›´æŠ‘åˆ¶ç­‰åˆè§„æ§åˆ¶ã€‚

---

## ğŸ‘¥ è§£å†³ä¸åŒè§’è‰²çš„æ ¸å¿ƒé—®é¢˜

### ğŸ‘¨â€ğŸ’» å¼€å‘è€…ï¼ˆDevelopersï¼‰

**æ ¸å¿ƒç—›ç‚¹**ï¼š
- **ç¯å¢ƒç¢ç‰‡åŒ–**ï¼šéœ€è¦ä¸ºä¸åŒç¯å¢ƒç¼–å†™ä¸åŒçš„éƒ¨ç½²è„šæœ¬ï¼Œç»´æŠ¤æˆæœ¬é«˜
- **éƒ¨ç½²å¤æ‚æ€§**ï¼šéœ€è¦äº†è§£æ¯ä¸ªç¯å¢ƒçš„ç‰¹æ®Šè¦æ±‚ï¼ˆK8sç‰ˆæœ¬ã€ç½‘ç»œç­–ç•¥ç­‰ï¼‰
- **å‘å¸ƒæµç¨‹ç¹ç**ï¼šéœ€è¦æ‰‹åŠ¨é€‰æ‹©ç›®æ ‡ç¯å¢ƒï¼Œç¼ºä¹è‡ªåŠ¨åŒ–æ¨å¹¿æœºåˆ¶
- **ç¼ºä¹çº¦æŸç®¡ç†**ï¼šæ— æ³•å®šä¹‰è·¨æœåŠ¡ä¾èµ–ã€æ•°æ®åº“ç‰ˆæœ¬è¦æ±‚ç­‰çº¦æŸ

**Tiangong Deploy è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… **ç»Ÿä¸€éƒ¨ç½²æ¨¡å‹**ï¼šæ‰€æœ‰ç¯å¢ƒä½¿ç”¨ç›¸åŒçš„éƒ¨ç½²æ¥å£ï¼Œè‡ªåŠ¨é€‚é…ç¯å¢ƒå·®å¼‚
- âœ… **å‘å¸ƒæ¸ é“æœºåˆ¶**ï¼šå®šä¹‰ RELEASE â†’ CANARY â†’ STABLE ç­‰æ¸ é“ï¼Œç¯å¢ƒè‡ªåŠ¨è®¢é˜…
- âœ… **çº¦æŸå¼•æ“**ï¼šå¼€å‘è€…å®šä¹‰äº§å“çº¦æŸï¼Œç¯å¢ƒå®šä¹‰ç¯å¢ƒçº¦æŸï¼Œç³»ç»Ÿè‡ªåŠ¨åè°ƒ
- âœ… **ä¸€æ¬¡ç¼–å†™**ï¼šå¼€å‘è€…åªéœ€å…³æ³¨ä»£ç ï¼Œéƒ¨ç½²ç”±å¹³å°è‡ªåŠ¨å¤„ç†

---

### ğŸ‘¨â€ğŸ’¼ ç¯å¢ƒæ“ä½œè€… / è¿ç»´äººå‘˜ï¼ˆEnvironment Operatorsï¼‰

**æ ¸å¿ƒç—›ç‚¹**ï¼š
- **å¤šç¯å¢ƒç®¡ç†å›°éš¾**ï¼šéœ€è¦ç®¡ç†å¤šä¸ªç¯å¢ƒï¼Œæ¯ä¸ªç¯å¢ƒå¯èƒ½æœ‰ä¸åŒçš„å·¥å…·å’Œæµç¨‹
- **å˜æ›´é£é™©æ§åˆ¶**ï¼šç¼ºä¹ç»Ÿä¸€çš„å˜æ›´å®¡æ‰¹æµç¨‹ï¼Œå˜æ›´å†å²éš¾ä»¥è¿½æº¯
- **éƒ¨ç½²æ“ä½œå¤æ‚**ï¼šéœ€è¦æ‰‹åŠ¨æ‰§è¡Œ SQLã€K8s éƒ¨ç½²ã€æ–‡ä»¶åˆ†å‘ç­‰æ“ä½œ
- **åˆè§„è¦æ±‚**ï¼šéœ€è¦æ»¡è¶³ç­‰ä¿ã€ISO 27001 ç­‰åˆè§„è¦æ±‚

**Tiangong Deploy è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… **ç»Ÿä¸€æ§åˆ¶é¢æ¿**ï¼šä¸€ä¸ªç•Œé¢ç®¡ç†æ‰€æœ‰ç¯å¢ƒï¼Œå®æ—¶æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
- âœ… **å˜æ›´ç®¡ç†**ï¼šå®šä¹‰å®¡æ‰¹æµç¨‹ã€ç»´æŠ¤çª—å£ã€å˜æ›´æŠ‘åˆ¶è§„åˆ™
- âœ… **é›¶ä»£ç æ“ä½œ**ï¼šé€šè¿‡ Web UI æˆ– CLI å®Œæˆæ‰€æœ‰æ“ä½œï¼Œæ— éœ€ç¼–å†™è„šæœ¬
- âœ… **å®Œæ•´å®¡è®¡**ï¼šæ‰€æœ‰å˜æ›´è‡ªåŠ¨è®°å½•ï¼Œæ”¯æŒå®¡è®¡å’Œè¿½æº¯
- âœ… **ç¯å¢ƒè®¢é˜…**ï¼šç¯å¢ƒè®¢é˜…åˆé€‚çš„å‘å¸ƒæ¸ é“ï¼Œè‡ªåŠ¨æ¥æ”¶ç¬¦åˆæ¡ä»¶çš„å‘å¸ƒ

### ğŸ”§ SRE/DevOps å·¥ç¨‹å¸ˆ

**æ ¸å¿ƒç—›ç‚¹**ï¼š
- **å·¥å…·é›†æˆå¤æ‚**ï¼šéœ€è¦é›†æˆ Ansibleã€Kubectlã€æ•°æ®åº“å®¢æˆ·ç«¯ç­‰å¤šç§å·¥å…·
- **è·¨ç¯å¢ƒè‡ªåŠ¨åŒ–å›°éš¾**ï¼šä¸åŒç¯å¢ƒçš„ç½‘ç»œã€è®¤è¯ã€æƒé™å·®å¼‚å¯¼è‡´è‡ªåŠ¨åŒ–è„šæœ¬å¤æ‚
- **å¯è§‚æµ‹æ€§ä¸è¶³**ï¼šéƒ¨ç½²è¿‡ç¨‹ç¼ºä¹å®æ—¶å¯è§æ€§ï¼Œé—®é¢˜å®šä½å›°éš¾
- **æ‰©å±•æ€§é™åˆ¶**ï¼šç°æœ‰å·¥å…·éš¾ä»¥æ‰©å±•æ–°çš„æ‰§è¡Œå™¨ç±»å‹

**Tiangong Deploy è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… **æ’ä»¶åŒ–æ¶æ„**ï¼šç»Ÿä¸€çš„ Executor æ¥å£ï¼Œæ˜“äºæ‰©å±•æ–°çš„æ‰§è¡Œå™¨ç±»å‹
- âœ… **ç»Ÿä¸€æ‰§è¡Œæ¨¡å‹**ï¼šæ‰€æœ‰æ“ä½œéƒ½é€šè¿‡ä»»åŠ¡ç³»ç»Ÿï¼Œæ”¯æŒ API è°ƒç”¨å’Œè‡ªåŠ¨åŒ–é›†æˆ
- âœ… **å®æ—¶å¯è§‚æµ‹æ€§**ï¼šWebSocket å®æ—¶æ—¥å¿—æµï¼Œæ”¯æŒä¸ Prometheusã€DataDog ç­‰ç›‘æ§å·¥å…·é›†æˆ
- âœ… **çµæ´»æ‰©å±•**ï¼šæ”¯æŒè‡ªå®šä¹‰æ‰§è¡Œå™¨ã€å·¥ä½œæµã€çº¦æŸæ¡ä»¶

---

### ğŸ”’ å®‰å…¨ä¸åˆè§„å›¢é˜Ÿï¼ˆSecurity & Complianceï¼‰

**æ ¸å¿ƒç—›ç‚¹**ï¼š
- **å˜æ›´æ§åˆ¶ä¸è¶³**ï¼šæ— æ³•é˜²æ­¢æœªæˆæƒçš„å˜æ›´ï¼Œç¼ºä¹å˜æ›´å®¡æ‰¹æµç¨‹
- **å®¡è®¡å›°éš¾**ï¼šå˜æ›´è®°å½•åˆ†æ•£ï¼Œç¼ºä¹ç»Ÿä¸€çš„å®¡è®¡æ—¥å¿—
- **å®‰å…¨ç­–ç•¥æ‰§è¡Œ**ï¼šæ— æ³•ç»Ÿä¸€æ‰§è¡Œå®‰å…¨ç­–ç•¥ï¼Œç¼ºä¹ç¯å¢ƒéš”ç¦»å’Œæƒé™æ§åˆ¶

**Tiangong Deploy è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… **å˜æ›´å®¡æ‰¹**ï¼šé›†æˆèº«ä»½æä¾›å•†ï¼ˆSAMLï¼‰ï¼Œå®šä¹‰å®¡æ‰¹æµç¨‹å’Œæˆæƒå®¡æ‰¹äºº
- âœ… **å®Œæ•´å®¡è®¡**ï¼šæ‰€æœ‰å˜æ›´è‡ªåŠ¨è®°å½•ï¼Œæ”¯æŒå®¡è®¡æŸ¥è¯¢å’ŒæŠ¥å‘Š
- âœ… **æƒé™æ§åˆ¶**ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ï¼Œæ”¯æŒç¯å¢ƒçº§åˆ«çš„æƒé™éš”ç¦»
- âœ… **åˆè§„æ¡†æ¶**ï¼šå†…ç½®åˆè§„æ§åˆ¶æœºåˆ¶ï¼Œæ”¯æŒç­‰ä¿ã€ISO 27001 ç­‰è¦æ±‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        UI[Tiangong Deploy UI<br/>React + TypeScript<br/>æ§åˆ¶å°ç•Œé¢]
    end

    subgraph "ä¸šåŠ¡æœåŠ¡å±‚"
        Service[Tiangong Deploy Service<br/>Gin + GORM<br/>ä¸šåŠ¡é€»è¾‘æ ¸å¿ƒ]
        ServiceAPI[REST API<br/>ä¸šåŠ¡æ¥å£]
        ServiceAuth[æƒé™æ§åˆ¶<br/>RBAC]
        ServiceBiz[ä¸šåŠ¡é€»è¾‘<br/>å‘å¸ƒ/éƒ¨ç½²/å˜æ›´]
    end

    subgraph "æ‰§è¡ŒæœåŠ¡å±‚"
        Cloud[Cloud Server<br/>Gin Framework<br/>ä»»åŠ¡æ‰§è¡Œå¼•æ“]
        CloudAPI[REST API<br/>æ‰§è¡Œæ¥å£]
        WS[WebSocket Server<br/>å®æ—¶é€šä¿¡]
        TaskMgr[ä»»åŠ¡ç®¡ç†å™¨<br/>Task Manager]
        AgentMgr[Agentç®¡ç†å™¨<br/>Agent Manager]
        FileStorage[æ–‡ä»¶å­˜å‚¨<br/>File Storage]
    end

    subgraph "æ•°æ®å±‚"
        DB[(MySQL/PostgreSQL<br/>å…±äº«æ•°æ®åº“)]
        DB_Service[ä¸šåŠ¡æ•°æ®è¡¨<br/>environments/products/releasesç­‰]
        DB_Cloud[æ‰§è¡Œæ•°æ®è¡¨<br/>agents/tasks/logs/filesç­‰]
    end

    subgraph "äº‘ä¸‹ Agent èŠ‚ç‚¹"
        Agent1[Agent 1<br/>K8s Cluster: prod]
        Agent2[Agent 2<br/>K8s Cluster: staging]
        Agent3[Agent 3<br/>K8s Cluster: dev]
    end

    subgraph "Agent å†…éƒ¨æ¶æ„"
        Client[WebSocket Client<br/>è¿æ¥ç®¡ç†]
        ExecMgr[æ‰§è¡Œå™¨ç®¡ç†å™¨<br/>Executor Manager]
        Plugins[æ’ä»¶ç³»ç»Ÿ<br/>Plugins]
        Shell[Shell Executor]
        MySQL[MySQL Executor<br/>goInception]
        K8s[K8s Executor<br/>client-go]
        API_Exec[API Executor]
        File_Exec[File Executor]
        DB_Plugins[æ•°æ®åº“æ’ä»¶<br/>Postgres/Redis/Mongoç­‰]
    end

    subgraph "å¤–éƒ¨æœåŠ¡"
        GoInception[goInception<br/>SQLå®¡æ ¸æ‰§è¡Œ]
        K8sAPI[Kubernetes API<br/>é›†ç¾¤æ“ä½œ]
    end

    UI -->|REST API| ServiceAPI
    ServiceAPI --> ServiceAuth
    ServiceAPI --> ServiceBiz
    ServiceBiz -->|æŸ¥è¯¢æ•°æ®| DB_Service
    ServiceBiz -->|æŸ¥è¯¢æ•°æ®| DB_Cloud
    ServiceBiz -->|æ‰§è¡Œæ“ä½œ| CloudAPI
    ServiceBiz --> DB

    CloudAPI --> TaskMgr
    CloudAPI --> AgentMgr
    CloudAPI --> FileStorage
    TaskMgr --> DB_Cloud
    AgentMgr --> DB_Cloud
    FileStorage --> DB_Cloud
    WS --> AgentMgr

    WS <-->|WebSocket<br/>é•¿è¿æ¥| Client
    Client --> ExecMgr
    ExecMgr --> Plugins
    Plugins --> Shell
    Plugins --> MySQL
    Plugins --> K8s
    Plugins --> API_Exec
    Plugins --> File_Exec
    Plugins --> DB_Plugins

    MySQL --> GoInception
    K8s --> K8sAPI

    AgentMgr -.->|ä»»åŠ¡æ´¾å‘| Agent1
    AgentMgr -.->|ä»»åŠ¡æ´¾å‘| Agent2
    AgentMgr -.->|ä»»åŠ¡æ´¾å‘| Agent3

    DB_Service -.-> DB
    DB_Cloud -.-> DB

    style UI fill:#e1f5ff
    style Service fill:#fff4e1
    style ServiceAPI fill:#fff4e1
    style Cloud fill:#e8f5e9
    style CloudAPI fill:#e8f5e9
    style WS fill:#e8f5e9
    style Agent1 fill:#ffebee
    style Agent2 fill:#ffebee
    style Agent3 fill:#ffebee
    style Plugins fill:#f3e5f5
    style DB fill:#e0f2f1
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

#### Tiangong Deploy UIï¼ˆå‰ç«¯æ§åˆ¶å°ï¼‰
- **æŠ€æœ¯æ ˆ**ï¼šReact 18 + TypeScript + Vite + Ant Design
- **åŠŸèƒ½æ¨¡å—**ï¼š11ä¸ªä¸€çº§èœå•ï¼ˆæ¦‚è§ˆã€ç¯å¢ƒã€äº§å“ã€å‘å¸ƒéƒ¨ç½²ã€ä»»åŠ¡ã€Agentã€å˜æ›´ã€å®¡è®¡ã€é…ç½®ã€ç›‘æ§ã€ç³»ç»Ÿç®¡ç†ï¼‰
- **é€šä¿¡æ–¹å¼**ï¼šREST API è°ƒç”¨ Service å±‚ï¼ŒWebSocket è¿æ¥ Cloud å±‚è·å–å®æ—¶æ—¥å¿—

#### Tiangong Deploy Serviceï¼ˆä¸šåŠ¡æœåŠ¡å±‚ï¼‰
- **æŠ€æœ¯æ ˆ**ï¼šGo + Gin + GORM
- **æ ¸å¿ƒèŒè´£**ï¼š
  - **ä¸šåŠ¡æ•°æ®ç®¡ç†**ï¼šç®¡ç†ç¯å¢ƒã€äº§å“ã€å‘å¸ƒã€éƒ¨ç½²ã€å˜æ›´ã€ç”¨æˆ·ã€æƒé™ç­‰æ ¸å¿ƒä¸šåŠ¡æ•°æ®
  - **ä¸šåŠ¡é€»è¾‘å¤„ç†**ï¼šå®ç°å‘å¸ƒå®¡æ‰¹ã€å˜æ›´æµè½¬ã€é…ç½®åŒæ­¥ã€åˆè§„æ£€æŸ¥ç­‰å¤æ‚ä¸šåŠ¡é€»è¾‘
  - **æ•°æ®æŸ¥è¯¢ä¸èšåˆ**ï¼šç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼ˆAgentã€Taskã€Logç­‰ï¼‰ï¼Œå‡å°‘RPCå¼€é”€
  - **æ“ä½œä»£ç†**ï¼šå¯¹äºéœ€è¦è§¦å‘åŠ¨ä½œçš„æ“ä½œï¼ˆæ‰§è¡Œä»»åŠ¡ã€åˆ†å‘æ–‡ä»¶ï¼‰ï¼Œé€šè¿‡APIè°ƒç”¨CloudæœåŠ¡
  - **æƒé™æ§åˆ¶**ï¼šå®ç°åŸºäºRBACçš„ç»†ç²’åº¦æƒé™æ§åˆ¶
- **æ•°æ®è®¿é—®ç­–ç•¥**ï¼š
  - **è¯»æ“ä½œ**ï¼šç›´æ¥æŸ¥è¯¢å…±äº«æ•°æ®åº“ï¼ˆå‡å°‘å»¶è¿Ÿï¼‰
  - **å†™/æ‰§è¡Œæ“ä½œ**ï¼šé€šè¿‡REST APIè°ƒç”¨CloudæœåŠ¡ï¼ˆç¡®ä¿WebSocketæ¨é€å’Œä»»åŠ¡è°ƒåº¦ï¼‰

#### Cloud Serverï¼ˆæ‰§è¡ŒæœåŠ¡å±‚ï¼‰
- **æŠ€æœ¯æ ˆ**ï¼šGo + Gin + WebSocket
- **æ ¸å¿ƒèŒè´£**ï¼š
  - **ä»»åŠ¡æ‰§è¡Œå¼•æ“**ï¼šä»»åŠ¡åˆ›å»ºã€æ´¾å‘ã€çŠ¶æ€è·Ÿè¸ªã€æ—¥å¿—æ”¶é›†
  - **Agentç®¡ç†**ï¼šAgentæ³¨å†Œã€å¿ƒè·³ç›‘æ§ã€è¿æ¥ç®¡ç†
  - **æ–‡ä»¶å­˜å‚¨**ï¼šæ–‡ä»¶ä¸Šä¼ ã€å­˜å‚¨ã€åˆ†å‘ç®¡ç†
  - **WebSocketæœåŠ¡**ï¼šä¸Agentä¿æŒé•¿è¿æ¥ï¼Œå®ç°å®æ—¶åŒå‘é€šä¿¡
- **æ•°æ®å­˜å‚¨**ï¼šAgentã€Taskã€Logã€Fileç­‰æ‰§è¡Œç›¸å…³æ•°æ®

#### Agentï¼ˆäº‘ä¸‹æ‰§è¡ŒèŠ‚ç‚¹ï¼‰
- **WebSocket Client**ï¼šè‡ªåŠ¨è¿æ¥åˆ°Cloudï¼Œç»´æŒé•¿è¿æ¥å’Œå¿ƒè·³
- **æ‰§è¡Œå™¨ç®¡ç†å™¨**ï¼šç»Ÿä¸€çš„ä»»åŠ¡æ‰§è¡Œæ¡†æ¶ï¼Œæ”¯æŒæ’ä»¶åŒ–æ‰©å±•
- **æ’ä»¶ç³»ç»Ÿ**ï¼š
  - **Shell Executor**ï¼šæ‰§è¡ŒShellå‘½ä»¤
  - **MySQL Executor**ï¼šé€šè¿‡goInceptionæ‰§è¡ŒSQLï¼Œæ”¯æŒå®¡æ ¸ã€å¤‡ä»½ã€å›æ»š
  - **K8s Executor**ï¼šä½¿ç”¨client-go SDKæ“ä½œKubernetesé›†ç¾¤
  - **API Executor**ï¼šæ‰§è¡ŒHTTP/HTTPSè¯·æ±‚
  - **File Executor**ï¼šæ–‡ä»¶å¤åˆ¶ã€åˆ é™¤ã€åˆ›å»ºç­‰æ“ä½œ
  - **æ•°æ®åº“æ’ä»¶**ï¼šPostgreSQLã€Redisã€MongoDBã€Elasticsearchã€ClickHouseã€Dorisç­‰

### é€šä¿¡æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·/UI
    participant S as Tiangong Deploy Service
    participant C as Cloud Server
    participant A as Agent

    Note over A: Agentå¯åŠ¨
    A->>C: WebSocketè¿æ¥
    A->>C: æ³¨å†Œæ¶ˆæ¯ï¼ˆAgent IDã€é›†ç¾¤ä¿¡æ¯ç­‰ï¼‰
    C->>A: æ³¨å†ŒæˆåŠŸå“åº”
    C->>S: æ›´æ–°AgentçŠ¶æ€ï¼ˆæ•°æ®åº“ï¼‰

    Note over U: ç”¨æˆ·åˆ›å»ºéƒ¨ç½²ä»»åŠ¡
    U->>S: POST /api/v1/deployments/:id/execute
    S->>S: æƒé™æ ¡éªŒ
    S->>S: è¯»å–Deploymenté…ç½®
    S->>S: ç”ŸæˆTaskå®šä¹‰
    S->>C: POST /api/v1/tasks (è°ƒç”¨Cloud API)
    C->>C: ä¿å­˜ä»»åŠ¡åˆ°æ•°æ®åº“
    C->>A: é€šè¿‡WebSocketå‘é€ä»»åŠ¡
    A->>A: æ‰§è¡Œå™¨æ‰§è¡Œä»»åŠ¡
    A->>C: å®æ—¶æ—¥å¿—æµï¼ˆWebSocketï¼‰
    C->>U: å®æ—¶æ—¥å¿—æ¨é€ï¼ˆWebSocketï¼‰
    A->>C: ä»»åŠ¡å®Œæˆé€šçŸ¥
    C->>C: æ›´æ–°ä»»åŠ¡çŠ¶æ€
    S->>S: è½®è¯¢/Webhookæ›´æ–°DeploymentçŠ¶æ€
    U->>S: GET /api/v1/deployments/:id
    S->>S: æŸ¥è¯¢æ•°æ®åº“ï¼ˆDeployment + Taskï¼‰
    S->>U: è¿”å›éƒ¨ç½²ç»“æœ
```

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸš€ Write Once, Deploy Anywhere
- å¼€å‘è€…åªéœ€ç¼–å†™ä¸€æ¬¡ä»£ç ï¼Œæ— éœ€å…³å¿ƒå¦‚ä½•åˆ°è¾¾æ‰€æœ‰ç¯å¢ƒ
- è‡ªåŠ¨å¤„ç†ä¸åŒç¯å¢ƒçš„é…ç½®å·®å¼‚ã€ç½‘ç»œé™åˆ¶ã€å®‰å…¨ç­–ç•¥
- æ”¯æŒå…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€æ··åˆäº‘ã€è¾¹ç¼˜èŠ‚ç‚¹ã€Air-gapped ç¯å¢ƒ

### ğŸ“¦ ç»Ÿä¸€çš„å¤šç¯å¢ƒç®¡ç†
- å•ä¸€æ§åˆ¶é¢æ¿ç®¡ç†æ‰€æœ‰ç¯å¢ƒï¼Œæ— è®ºä½ç½®æˆ–è¿æ¥çŠ¶æ€
- æ”¯æŒè¿æ¥ç¯å¢ƒã€æ–­å¼€è¿æ¥ç¯å¢ƒï¼ˆair-gappedï¼‰ã€æ··åˆç¯å¢ƒ
- å®æ—¶æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒçš„éƒ¨ç½²çŠ¶æ€å’Œå¥åº·æƒ…å†µ

### ğŸ”„ å‘å¸ƒæ¸ é“æœºåˆ¶ï¼ˆRelease Channelsï¼‰
- å®šä¹‰å‘å¸ƒæ¸ é“ï¼ˆå¦‚ RELEASEã€CANARYã€STABLEï¼‰
- ç¯å¢ƒè®¢é˜…åˆé€‚çš„å‘å¸ƒæ¸ é“ï¼Œè‡ªåŠ¨æ¥æ”¶ç¬¦åˆæ¡ä»¶çš„å‘å¸ƒ
- è‡ªåŠ¨æ¨å¹¿æœºåˆ¶ï¼šæ»¡è¶³æ¡ä»¶åè‡ªåŠ¨æ¨å¹¿åˆ°ä¸‹ä¸€ä¸ªæ¸ é“

### ğŸ›¡ï¸ åˆè§„æ„ŸçŸ¥çš„å˜æ›´ç®¡ç†
- å†…ç½®å˜æ›´å®¡æ‰¹æµç¨‹ï¼Œé˜²æ­¢æœªæˆæƒå˜æ›´
- å®Œæ•´çš„å®¡è®¡è·Ÿè¸ªï¼Œæ»¡è¶³åˆè§„è¦æ±‚ï¼ˆç­‰ä¿ã€ISO 27001ç­‰ï¼‰
- æ”¯æŒç»´æŠ¤çª—å£ã€å˜æ›´æŠ‘åˆ¶ç­‰åˆè§„æ§åˆ¶
- åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰

### ğŸ§© æ’ä»¶å¼æ‰©å±•æ¶æ„
- ç»Ÿä¸€çš„ Executor æ¥å£ï¼Œæ˜“äºå¼€å‘è‡ªå®šä¹‰æ‰§è¡Œå™¨
- æ”¯æŒ Shellã€SQLã€K8sã€APIã€æ–‡ä»¶æ“ä½œç­‰å¤šç§æ‰§è¡Œå™¨
- é€šè¿‡ YAML é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½æ’ä»¶
- æ”¯æŒå¤šæ•°æ®åº“ç±»å‹ï¼ˆMySQLã€PostgreSQLã€Redisã€MongoDBç­‰ï¼‰

### â˜¸ï¸ Kubernetes åŸç”Ÿæ”¯æŒ
- ä½¿ç”¨ `client-go` SDK ç›´æ¥æ“ä½œ Kubernetes
- æ”¯æŒ in-cluster é…ç½®ï¼ˆåœ¨Podä¸­è‡ªåŠ¨ä½¿ç”¨ï¼‰
- æ”¯æŒ kubeconfig æ–‡ä»¶é…ç½®ï¼ˆé›†ç¾¤å¤–è¿è¡Œï¼‰
- Agentè‡ªåŠ¨ä¸ŠæŠ¥æ‰€åœ¨K8sé›†ç¾¤åç§°ï¼Œä¾¿äºå¤šé›†ç¾¤ç®¡ç†

### ğŸ‘€ å®æ—¶å¯è§‚æµ‹æ€§
- WebSocket å®æ—¶æ—¥å¿—æµå¼ä¼ è¾“
- ä»»åŠ¡çŠ¶æ€å®æ—¶æ›´æ–°ï¼ˆpending â†’ running â†’ success/failedï¼‰
- æ”¯æŒä¸ Prometheusã€DataDog ç­‰ç›‘æ§å·¥å…·é›†æˆ
- å®Œæ•´çš„æ“ä½œå†å²è®°å½•å’Œæ—¥å¿—å›æ”¾

### ğŸ” SQL å®¡æ ¸ä¸æ‰§è¡Œ
- é›†æˆ [goInception](https://github.com/hanchuanchuan/goInception)ï¼Œæä¾›SQLå®¡æ ¸åŠŸèƒ½
- æ”¯æŒSQLæ‰§è¡Œã€è‡ªåŠ¨å¤‡ä»½ã€ç”Ÿæˆå›æ»šè¯­å¥
- æ”¯æŒMySQLã€PostgreSQLç­‰å¤šç§æ•°æ®åº“

### ğŸ“Š çº¦æŸå¼•æ“ï¼ˆè§„åˆ’ä¸­ï¼‰
- å¼€å‘è€…å®šä¹‰äº§å“çº¦æŸï¼ˆä¾èµ–ã€ç‰ˆæœ¬è¦æ±‚ç­‰ï¼‰
- ç¯å¢ƒå®šä¹‰ç¯å¢ƒçº¦æŸï¼ˆç»´æŠ¤çª—å£ã€å˜æ›´é™åˆ¶ç­‰ï¼‰
- ç³»ç»Ÿè‡ªåŠ¨åè°ƒçº¦æŸï¼Œç¡®ä¿å®‰å…¨éƒ¨ç½²

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **Go 1.21+**
- **Node.js 18+**ï¼ˆå‰ç«¯å¼€å‘éœ€è¦ï¼‰
- **MySQL 8.0+ æˆ– PostgreSQL 13+**ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼Œå¼€å‘ç¯å¢ƒå¯ç”¨ SQLiteï¼‰
- **goInception æœåŠ¡**ï¼ˆSQLæ‰§è¡Œå™¨éœ€è¦ï¼Œå¯é€‰ï¼‰
  ```bash
  # ä¸‹è½½å¹¶å¯åŠ¨ goInception
  docker pull hanchuanchuan/goinception
  docker run -d -p 4000:4000 hanchuanchuan/goinception
  ```

### æ–¹å¼ä¸€ï¼šDocker Composeï¼ˆæ¨èï¼‰

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd tiangong-deploy

# å¯åŠ¨æœåŠ¡
docker-compose -f deployments/docker-compose.yml up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f deployments/docker-compose.yml logs -f
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

#### 1. å¯åŠ¨æ•°æ®åº“ï¼ˆMySQL/PostgreSQLï¼‰

```bash
# ä½¿ç”¨ Docker å¯åŠ¨ MySQLï¼ˆç¤ºä¾‹ï¼‰
docker run -d \
  --name tiangong-mysql \
  -e MYSQL_ROOT_PASSWORD=password \
  -e MYSQL_DATABASE=tiangong_deploy \
  -p 3306:3306 \
  mysql:8.0
```

#### 2. å¯åŠ¨ Cloud æœåŠ¡ï¼ˆæ‰§è¡Œå¼•æ“ï¼‰

```bash
go run cmd/cloud/main.go \
  -addr :8080 \
  -db "mysql://user:password@localhost:3306/tiangong_deploy" \
  -storage ./data/files
```

#### 3. å¯åŠ¨ Tiangong Deploy Serviceï¼ˆä¸šåŠ¡æœåŠ¡ï¼‰

```bash
go run cmd/service/main.go \
  -addr :8081 \
  -db "mysql://user:password@localhost:3306/tiangong_deploy" \
  -cloud-url http://localhost:8080
```

#### 4. å¯åŠ¨ Agent

```bash
# è®¾ç½® K8s é›†ç¾¤åç§°ï¼ˆå¯é€‰ï¼‰
export K8S_CLUSTER_NAME=production

# å¯åŠ¨ Agent
go run cmd/agent/main.go -cloud http://localhost:8080 -name my-agent
```

#### 5. å¯åŠ¨å‰ç«¯ UI

```bash
cd tiangong-deploy-ui
npm install
npm run dev
```

#### 6. è®¿é—® Web UI

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:5173ï¼ˆå‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼‰  
æˆ–è®¿é—®ï¼šhttp://localhost:8081ï¼ˆService æœåŠ¡ï¼Œå¦‚æœé…ç½®äº†é™æ€æ–‡ä»¶æœåŠ¡ï¼‰

### æ–¹å¼ä¸‰ï¼šKubernetes éƒ¨ç½²

```bash
# ä½¿ç”¨ Helm Chart éƒ¨ç½²
helm install tiangong-deploy ./deployments/helm/tiangong-deploy
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### Web UI ä½¿ç”¨

1. **Agent ç®¡ç†**ï¼šæŸ¥çœ‹æ‰€æœ‰å·²æ³¨å†Œçš„AgentèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬çŠ¶æ€ã€é›†ç¾¤ä¿¡æ¯ç­‰
2. **ä»»åŠ¡åˆ›å»º**ï¼šé€‰æ‹©Agentã€ä»»åŠ¡ç±»å‹ï¼ˆShell/SQL/K8sç­‰ï¼‰ï¼Œè¾“å…¥å‘½ä»¤æˆ–ä¸Šä¼ æ–‡ä»¶
3. **å®æ—¶æ—¥å¿—**ï¼šä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å®æ—¶æŸ¥çœ‹æ—¥å¿—è¾“å‡º
4. **æ–‡ä»¶ç®¡ç†**ï¼šä¸Šä¼ æ–‡ä»¶ï¼Œä¸€é”®åˆ†å‘åˆ°å¤šä¸ªAgentèŠ‚ç‚¹
5. **å†å²è®°å½•**ï¼šæŸ¥çœ‹æ‰€æœ‰å†å²ä»»åŠ¡ï¼Œæ”¯æŒæ—¥å¿—å›æ”¾

### CLI å·¥å…·ä½¿ç”¨

```bash
# æ„å»º CLI å·¥å…·
go build -o cloudctl cmd/cli/main.go

# æ‰§è¡Œ Shell å‘½ä»¤
./cloudctl run -type shell -command "ls -la" -agent <agent-id>

# æ‰§è¡Œ SQL
./cloudctl run -type mysql -file demo.sql -agent <agent-id> -params '{"connection":"default"}'

# ä¸Šä¼ æ–‡ä»¶
./cloudctl upload -file demo.zip

# åˆ†å‘æ–‡ä»¶åˆ°Agent
./cloudctl distribute -file <file-id> -agents <agent-id1>,<agent-id2>

# æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨
./cloudctl list -resource tasks

# æŸ¥çœ‹ä»»åŠ¡æ—¥å¿—
./cloudctl logs -task <task-id>
```

### API è°ƒç”¨ç¤ºä¾‹

```bash
# åˆ›å»ºä»»åŠ¡
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "agent_id": "agent-123",
    "type": "shell",
    "command": "ls -la /tmp"
  }'

# æŸ¥è¯¢ä»»åŠ¡
curl http://localhost:8080/api/v1/tasks/<task-id>

# ä¸Šä¼ æ–‡ä»¶
curl -X POST http://localhost:8080/api/v1/files \
  -F "file=@demo.zip"
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### Agent æ’ä»¶é…ç½®

ç¼–è¾‘ `configs/agent-plugins.yaml` æ¥é…ç½®æ‰§è¡Œå™¨æ’ä»¶ï¼š

```yaml
plugins:
  # Shell å‘½ä»¤æ‰§è¡Œå™¨
  - type: shell
    enabled: true
    config:
      timeout: 1800  # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰

  # MySQL æ‰§è¡Œå™¨ï¼ˆä½¿ç”¨ goInceptionï¼‰
  - type: mysql
    enabled: true
    config:
      goinception_url: http://localhost:4000
      connections:
        - name: default
          database: test

  # PostgreSQL æ‰§è¡Œå™¨
  - type: postgres
    enabled: true
    config:
      connections:
        - name: default
          host: localhost
          port: 5432
          database: test
          username: postgres

  # Kubernetes æ‰§è¡Œå™¨
  - type: k8s
    enabled: true
    config:
      kubeconfig: ~/.kube/config  # å¯é€‰ï¼ŒPodä¸­è‡ªåŠ¨ä½¿ç”¨in-clusteré…ç½®
      namespace: default

  # HTTP API æ‰§è¡Œå™¨
  - type: api
    enabled: true
    config:
      timeout: 30
      verify_ssl: true

  # æ–‡ä»¶æ“ä½œæ‰§è¡Œå™¨
  - type: file
    enabled: true
    config:
      base_path: /tmp/tiangong-deploy
```

**é…ç½®è¯´æ˜**ï¼š

1. **æ•°æ®åº“æ‰§è¡Œå™¨**ï¼š
   - **MySQL**ï¼šä½¿ç”¨ goInception æä¾›SQLå®¡æ ¸ã€æ‰§è¡Œã€å¤‡ä»½å’Œå›æ»šåŠŸèƒ½
   - **PostgreSQL/Redis/MongoDB**ï¼šç›´æ¥è¿æ¥æ•°æ®åº“æ‰§è¡Œ
   - æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶ä¸ºæ¯ç§æ•°æ®åº“ç±»å‹é…ç½®å¤šä¸ªè¿æ¥

2. **K8s æ‰§è¡Œå™¨**ï¼š
   - åœ¨ Kubernetes Pod ä¸­è¿è¡Œæ—¶è‡ªåŠ¨ä½¿ç”¨ in-cluster é…ç½®
   - åœ¨é›†ç¾¤å¤–è¿è¡Œæ—¶ä½¿ç”¨ kubeconfig æ–‡ä»¶
   - æ”¯æŒ apply YAMLã€getã€listã€deleteã€describe ç­‰æ“ä½œ

---

## ğŸ“š API æ–‡æ¡£

### Tiangong Deploy Service APIï¼ˆä¸šåŠ¡æ¥å£ï¼‰

#### ç¯å¢ƒç®¡ç†
- `GET /api/v1/environments` - è·å–ç¯å¢ƒåˆ—è¡¨
- `GET /api/v1/environments/:id` - è·å–ç¯å¢ƒè¯¦æƒ…
- `POST /api/v1/environments` - åˆ›å»ºç¯å¢ƒ
- `PUT /api/v1/environments/:id` - æ›´æ–°ç¯å¢ƒ
- `DELETE /api/v1/environments/:id` - åˆ é™¤ç¯å¢ƒ

#### äº§å“ç®¡ç†
- `GET /api/v1/products` - è·å–äº§å“åˆ—è¡¨
- `GET /api/v1/products/:id` - è·å–äº§å“è¯¦æƒ…
- `POST /api/v1/products` - åˆ›å»ºäº§å“
- `GET /api/v1/products/:id/versions` - è·å–äº§å“ç‰ˆæœ¬åˆ—è¡¨

#### å‘å¸ƒä¸éƒ¨ç½²
- `GET /api/v1/releases` - å‘å¸ƒåˆ—è¡¨
- `POST /api/v1/releases` - åˆ›å»ºå‘å¸ƒ
- `POST /api/v1/releases/:id/approve` - å®¡æ‰¹å‘å¸ƒ
- `GET /api/v1/deployments` - éƒ¨ç½²åˆ—è¡¨
- `POST /api/v1/deployments` - åˆ›å»ºéƒ¨ç½²è®¡åˆ’
- `POST /api/v1/deployments/:id/execute` - æ‰§è¡Œéƒ¨ç½²
- `POST /api/v1/deployments/:id/rollback` - å›æ»šéƒ¨ç½²

#### å˜æ›´ç®¡ç†
- `GET /api/v1/changes` - å˜æ›´åˆ—è¡¨
- `POST /api/v1/changes` - åˆ›å»ºå˜æ›´è¯·æ±‚
- `POST /api/v1/changes/:id/approve` - å®¡æ‰¹å˜æ›´
- `POST /api/v1/changes/:id/execute` - æ‰§è¡Œå˜æ›´

#### å®¡è®¡æ—¥å¿—
- `GET /api/v1/audit-logs` - æŸ¥è¯¢å®¡è®¡æ—¥å¿—
- `GET /api/v1/audit-logs/export` - å¯¼å‡ºå®¡è®¡æ—¥å¿—

### Cloud Server APIï¼ˆæ‰§è¡Œæ¥å£ï¼‰

#### Agent API
- `GET /api/v1/agents` - åˆ—å‡ºæ‰€æœ‰Agentï¼ˆServiceå±‚ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼‰
- `GET /api/v1/agents/:id` - è·å–Agentä¿¡æ¯

#### Task API
- `POST /api/v1/tasks` - åˆ›å»ºä»»åŠ¡ï¼ˆServiceå±‚è°ƒç”¨æ­¤æ¥å£ï¼‰
- `GET /api/v1/tasks` - åˆ—å‡ºä»»åŠ¡ï¼ˆServiceå±‚ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼‰
- `GET /api/v1/tasks/:id` - è·å–ä»»åŠ¡ä¿¡æ¯
- `GET /api/v1/tasks/:id/logs` - è·å–ä»»åŠ¡æ—¥å¿—

#### File API
- `POST /api/v1/files` - ä¸Šä¼ æ–‡ä»¶ï¼ˆServiceå±‚è°ƒç”¨æ­¤æ¥å£ï¼‰
- `GET /api/v1/files` - åˆ—å‡ºæ–‡ä»¶ï¼ˆServiceå±‚ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼‰
- `GET /api/v1/files/:id/download` - ä¸‹è½½æ–‡ä»¶
- `POST /api/v1/files/:id/distribute` - åˆ†å‘æ–‡ä»¶åˆ°Agent

### WebSocket

- `WS /ws` - WebSocketè¿æ¥ï¼ˆCloud Serverï¼‰ï¼Œç”¨äºAgentæ³¨å†Œå’Œå®æ—¶æ—¥å¿—ä¼ è¾“

è¯¦ç»†çš„APIæ–‡æ¡£è¯·å‚è€ƒï¼š
- [Cloud APIæ¥å£æ–‡æ¡£](./docs/0-cloud-APIæ¥å£æ–‡æ¡£.md)
- [Serviceè®¾è®¡æ–¹æ¡ˆ](./docs/5-tiangong-deploy-serviceè®¾è®¡æ–¹æ¡ˆ.md)

---

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
tiangong-deploy/
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ cloud/          # Cloud æœåŠ¡å…¥å£ï¼ˆæ‰§è¡Œå¼•æ“ï¼‰
â”‚   â”œâ”€â”€ agent/          # Agent æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ service/        # Tiangong Deploy Service å…¥å£ï¼ˆä¸šåŠ¡æœåŠ¡ï¼‰
â”‚   â””â”€â”€ cli/            # CLI å·¥å…·
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ cloud/          # Cloud æœåŠ¡æ ¸å¿ƒä»£ç ï¼ˆæ‰§è¡Œå±‚ï¼‰
â”‚   â”‚   â”œâ”€â”€ server/     # HTTP/WebSocket æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ task/       # ä»»åŠ¡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ agent/      # Agent è¿æ¥ç®¡ç†
â”‚   â”‚   â””â”€â”€ storage/    # æ•°æ®å­˜å‚¨å±‚
â”‚   â”œâ”€â”€ service/         # Tiangong Deploy Service æ ¸å¿ƒä»£ç ï¼ˆä¸šåŠ¡å±‚ï¼‰
â”‚   â”‚   â”œâ”€â”€ server/     # HTTP æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ handlers/   # API å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ models/      # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ services/   # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ middleware/  # ä¸­é—´ä»¶ï¼ˆæƒé™ã€å®¡è®¡ç­‰ï¼‰
â”‚   â”‚   â””â”€â”€ storage/    # æ•°æ®å­˜å‚¨å±‚
â”‚   â”œâ”€â”€ agent/          # Agent æ ¸å¿ƒä»£ç 
â”‚   â”‚   â”œâ”€â”€ client/     # Cloud è¿æ¥å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ executor/   # æ‰§è¡Œå™¨æ¡†æ¶
â”‚   â”‚   â””â”€â”€ plugins/    # æ’ä»¶å®ç°
â”‚   â””â”€â”€ common/         # å…±äº«ä»£ç ï¼ˆåè®®ã€æ¨¡å‹ç­‰ï¼‰
â”œâ”€â”€ tiangong-deploy-ui/ # å‰ç«¯æ§åˆ¶å°ï¼ˆReactï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/ # UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/      # é¡µé¢ï¼ˆ11ä¸ªä¸€çº§èœå•ï¼‰
â”‚   â”‚   â”œâ”€â”€ services/   # API æœåŠ¡
â”‚   â”‚   â””â”€â”€ types/      # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ cloud-ui/           # æ—§ç‰ˆç®€å•UIï¼ˆä¿ç•™å…¼å®¹ï¼‰
â”œâ”€â”€ configs/            # é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”œâ”€â”€ deployments/        # Docker/Helm éƒ¨ç½²æ–‡ä»¶
â””â”€â”€ docs/              # æ–‡æ¡£
```

### æ„å»º

```bash
# æ„å»º Cloudï¼ˆæ‰§è¡Œå¼•æ“ï¼‰
go build -o bin/cloud ./cmd/cloud

# æ„å»º Serviceï¼ˆä¸šåŠ¡æœåŠ¡ï¼‰
go build -o bin/service ./cmd/service

# æ„å»º Agent
go build -o bin/agent ./cmd/agent

# æ„å»º CLI
go build -o bin/cloudctl ./cmd/cli

# æ„å»ºå‰ç«¯ UI
cd tiangong-deploy-ui && npm install && npm run build
```

### å¼€å‘è‡ªå®šä¹‰æ‰§è¡Œå™¨

å®ç° `plugins.Executor` æ¥å£ï¼š

```go
type Executor interface {
    Type() common.TaskType
    Execute(taskID string, command string, params map[string]interface{}, 
            fileID string, logCallback LogCallback) (string, error)
}
```

åœ¨ `configs/agent-plugins.yaml` ä¸­æ³¨å†Œï¼š

```yaml
plugins:
  - type: custom
    enabled: true
    config:
      # è‡ªå®šä¹‰é…ç½®
```

---

## ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šè·¨åœ°åŸŸåº”ç”¨å‘å¸ƒ

1. ä¸Šä¼ å‘å¸ƒåŒ…ï¼ˆåŒ…å«SQLã€YAMLã€è„šæœ¬ï¼‰
2. é€‰æ‹©å¤šä¸ªç¯å¢ƒçš„AgentèŠ‚ç‚¹
3. ä¾æ¬¡æ‰§è¡Œï¼šSQLæ›´æ–° â†’ K8séƒ¨ç½² â†’ å¥åº·æ£€æŸ¥
4. å®æ—¶æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹çš„æ‰§è¡Œæ—¥å¿—
5. å¤±è´¥èŠ‚ç‚¹å¯å•ç‹¬é‡è¯•

### åœºæ™¯2ï¼šæ•°æ®åº“æ‰¹é‡æ“ä½œ

1. ä¸Šä¼ SQLè„šæœ¬æ–‡ä»¶
2. é€‰æ‹©ç›®æ ‡æ•°æ®åº“è¿æ¥
3. é€šè¿‡goInceptionå®¡æ ¸SQL
4. æ‰§è¡ŒSQLå¹¶è‡ªåŠ¨å¤‡ä»½
5. å¦‚éœ€å›æ»šï¼Œä½¿ç”¨ç”Ÿæˆçš„å›æ»šSQL

### åœºæ™¯3ï¼šKuberneteså¤šé›†ç¾¤ç®¡ç†

1. åœ¨ä¸åŒK8sé›†ç¾¤éƒ¨ç½²Agent
2. Agentè‡ªåŠ¨ä¸ŠæŠ¥é›†ç¾¤åç§°
3. åœ¨Web UIä¸­æŒ‰é›†ç¾¤ç­›é€‰Agent
4. ç»Ÿä¸€æ‰§è¡ŒK8sæ“ä½œï¼ˆapplyã€getã€deleteç­‰ï¼‰
5. å®æ—¶æŸ¥çœ‹Podæ—¥å¿—å’ŒçŠ¶æ€

---

## ğŸ”’ å®‰å…¨å»ºè®®

- **ç”Ÿäº§ç¯å¢ƒ**ï¼š
  - å¯ç”¨HTTPS/WSSåŠ å¯†é€šä¿¡
  - é…ç½®Agentè®¤è¯ï¼ˆTokenæˆ–mTLSï¼‰
  - é™åˆ¶WebSocketæ¥æºï¼ˆCheckOriginï¼‰
  - ä½¿ç”¨PostgreSQLæ›¿ä»£SQLite
  - é…ç½®æ•°æ®åº“è¿æ¥ç™½åå•

- **æƒé™æ§åˆ¶**ï¼š
  - Agentæ‰§è¡Œå™¨é…ç½®æœ€å°æƒé™
  - K8sæ‰§è¡Œå™¨ä½¿ç”¨ServiceAccounté™åˆ¶æƒé™
  - æ–‡ä»¶æ“ä½œé™åˆ¶åœ¨æŒ‡å®šç›®å½•

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

---

## ğŸ“ è”ç³»æ–¹å¼

- **é¡¹ç›®åœ°å€**ï¼šhttps://github.com/comqx/tiangong-deploy
- **é—®é¢˜åé¦ˆ**ï¼šhttps://github.com/comqx/tiangong-deploy/issues

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ ¸å¿ƒç›®æ ‡ä¸è§’è‰²ç—›ç‚¹åˆ†æ](./docs/3-æ ¸å¿ƒç›®æ ‡ä¸è§’è‰²ç—›ç‚¹åˆ†æ.md) - è¯¦ç»†åˆ†æå„è§’è‰²çš„ç—›ç‚¹å’Œè§£å†³æ–¹æ¡ˆ
- [Tiangong Deploy UI æ¨¡å—è®¾è®¡](./docs/4-tiangong-deploy-uiæ¨¡å—è®¾è®¡.md) - UI æ¨¡å—è¯¦ç»†è®¾è®¡
- [Tiangong Deploy UI èœå•ä¸åŠŸèƒ½è®¾è®¡](./docs/4-1-tiangong-deploy-uièœå•ä¸åŠŸèƒ½è¯¦ç»†è®¾è®¡.md) - UI èœå•å’ŒåŠŸèƒ½è¯¦ç»†æ¸…å•
- [Tiangong Deploy Service æŠ€æœ¯æ–¹æ¡ˆ](./docs/5-tiangong-deploy-serviceè®¾è®¡æ–¹æ¡ˆ.md) - Service æœåŠ¡æŠ€æœ¯æ–¹æ¡ˆ
- [Cloud API æ¥å£æ–‡æ¡£](./docs/0-cloud-APIæ¥å£æ–‡æ¡£.md) - Cloud æœåŠ¡ API æ¥å£è¯´æ˜
- [é¡¹ç›®éœ€æ±‚å’ŒåŠŸèƒ½è¦æ±‚](./docs/1-é¡¹ç›®éœ€æ±‚å’ŒåŠŸèƒ½è¦æ±‚.md) - é¡¹ç›®éœ€æ±‚æ–‡æ¡£

## ğŸ”— å‚è€ƒ

- [Palantir Apollo](https://www.palantir.com/docs/apollo/core/introduction/) - Tiangong Deploy å¯¹æ ‡çš„å•†ä¸šäº§å“

---

**Tiangong Deploy** - ä¸€æ¬¡ç¼–å†™ï¼Œéšå¤„éƒ¨ç½²ã€‚è®©å¼€å‘è€…ä¸“æ³¨äºåˆ›æ–°ï¼Œè€Œä¸æ˜¯åŸºç¡€è®¾æ–½çš„å¤æ‚æ€§ ğŸš€
